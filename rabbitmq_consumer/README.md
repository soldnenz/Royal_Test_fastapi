# RabbitMQ Consumer

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ª–æ–≥–æ–≤ –∏–∑ RabbitMQ. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–æ–≥–∏ –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞ 2FA.

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. `consumer.py` - –û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å –ª–æ–≥–æ–≤
–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ª–æ–≥–∏ –∏ –≤—ã–≤–æ–¥–∏—Ç –∏—Ö –≤ –∫–æ–Ω—Å–æ–ª—å —Å –∫—Ä–∞—Å–∏–≤—ã–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º.

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ routing keys:**
- `application.logs` - –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- `2fa.logs` - –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å 2FA
- `auth.logs` - –õ–æ–≥–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- `security.logs` - –õ–æ–≥–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- `system.logs` - –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏

### 2. `log_consumer.py` - –ü—Ä–æ—Å—Ç–æ–π –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å
–£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.

### 3. `telegram_log_bot.py` - Telegram –±–æ—Ç
–ü–µ—Ä–µ—Å—ã–ª–∞–µ—Ç –ª–æ–≥–∏ –≤ Telegram –≥—Ä—É–ø–ø—É —Å —Ñ–æ—Ä—É–º–æ–º (—Ç–æ–ø–∏–∫–∞–º–∏).

### 4. `topic_helper_bot.py` - –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –±–æ—Ç
–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ª–æ–≥–∞–º–∏.

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
venv\Scripts\activate     # Windows
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
pip install -r requirements.txt
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

#### RabbitMQ
```bash
RABBITMQ_URL=amqp://guest:guest@localhost:5672/
RABBITMQ_EXCHANGE=logs
RABBITMQ_QUEUE=log_processing_queue
```

#### Telegram (–¥–ª—è telegram_log_bot.py)
```bash
TELEGRAM_BOT_TOKEN=your_bot_token
TELEGRAM_CHAT_ID=-1002793640921
TELEGRAM_WARNING_TOPIC=2
TELEGRAM_ERROR_TOPIC=3
```

## –ó–∞–ø—É—Å–∫

### –û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å
```bash
python consumer.py
```

### –ü—Ä–æ—Å—Ç–æ–π –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å
```bash
python log_consumer.py
```

### Telegram –±–æ—Ç
```bash
python telegram_log_bot.py
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–æ–≤

–õ–æ–≥–∏ –æ—Ç –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞ 2FA —Å–æ–¥–µ—Ä–∂–∞—Ç —Å–ª–µ–¥—É—é—â–∏–µ –ø–æ–ª—è:

```json
{
  "timestamp": "2025-07-05T03:04:06.652804+05:00",
  "log_id": "6278b136-d0c2-4eda-958f-573cef7ed75b",
  "level": "INFO",
  "section": "2fa",
  "subsection": "request_sent",
  "message": "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –û–º–∞—Ä –ê–º–∏—Ä –ê—Ä–º–∞–Ω—É–ª—ã –ø—ã—Ç–∞–µ—Ç—Å—è –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É",
  "extra_data": {
    "source_file": "telegram_bot.py",
    "source_function": "send_2fa_request",
    "source_line": 72
  },
  "source": "2fa_structured_logger"
}
```

## –≠–º–æ–¥–∑–∏ –¥–ª—è —É—Ä–æ–≤–Ω–µ–π

- üîç DEBUG
- ‚ÑπÔ∏è INFO
- ‚ö†Ô∏è WARNING
- ‚ùå ERROR
- üî• CRITICAL

## –≠–º–æ–¥–∑–∏ –¥–ª—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

- üîê 2FA –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å
- üì± –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- üîë –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚öôÔ∏è –°–∏—Å—Ç–µ–º–∞

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ü–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –∫ RabbitMQ
- –°–æ–∑–¥–∞—é—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –æ—á–µ—Ä–µ–¥–∏ –∏ –ø—Ä–∏–≤—è–∑–∫–∏
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –õ–æ–≥–∏—Ä—É—é—Ç –æ—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

## Troubleshooting

### –°–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ RabbitMQ
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ exchange `logs` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ routing keys –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö

### Telegram –±–æ—Ç –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≥—Ä—É–ø–ø—É
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –±–æ—Ç–∞ –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π

### –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ RabbitMQ
- –£–≤–µ–ª–∏—á—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ prefetch count
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–µ–π 
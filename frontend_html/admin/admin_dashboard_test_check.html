<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <style>
        :root {
            /* Theme Colors */
            --light-bg: #FFFFFF;
            --light-sidebar-bg: #F8F9FA;
            --light-card-bg: #FFFFFF;
            --light-border: #E9ECEF;
            --light-text: #212529;
            --light-text-secondary: #6C757D;
            --light-accent: #bcc3c99d;
            --light-accent-text: #333;
            --light-hover-bg: #F0F2F5;
            --light-main-bg: #F8F9FA;
            --hub-orange: #FF9000;
            --hub-text: #FFFFFF;

            --dark-bg: #16191C;
            --dark-sidebar-bg: #1F2326;
            --dark-card-bg: #1F2326;
            --dark-border: #32383E;
            --dark-text: #E1E3E5;
            --dark-text-secondary: #ADB5BD;
            --dark-accent: #FFD700;
            --dark-accent-text: #1C1C1C;
            --dark-hover-bg: #2A2E33;
            --dark-main-bg: #16191C;

            /* Custom Colors */
            --primary-color: var(--hub-orange);
            --primary-text: var(--hub-text);
            --dark-primary-color: var(--dark-accent);
            --dark-primary-text: var(--dark-accent-text);

            /* Layout */
            --sidebar-width: 260px;
            --header-height: 60px;
        }

        html[data-theme="light"] {
            --bg: var(--light-bg);
            --sidebar-bg: var(--light-sidebar-bg);
            --card-bg: var(--light-card-bg);
            --border: var(--light-border);
            --text: var(--light-text);
            --text-secondary: var(--light-text-secondary);
            --accent: var(--light-accent);
            --accent-text: var(--light-accent-text);
            --hover-bg: var(--light-hover-bg);
            --main-bg: var(--light-main-bg);
            --primary-active: var(--primary-color);
            --primary-active-text: var(--primary-text);
        }

        html[data-theme="dark"] {
            --bg: var(--dark-bg);
            --sidebar-bg: var(--dark-sidebar-bg);
            --card-bg: var(--dark-card-bg);
            --border: var(--dark-border);
            --text: var(--dark-text);
            --text-secondary: var(--dark-text-secondary);
            --accent: var(--dark-accent);
            --accent-text: var(--dark-accent-text);
            --hover-bg: var(--dark-hover-bg);
            --main-bg: var(--dark-main-bg);
            --primary-active: var(--dark-primary-color);
            --primary-active-text: var(--dark-primary-text);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.5;
        }

        .dark-theme {
            background-color: var(--dark-bg);
            color: var(--dark-text);
        }

        /* Sidebar Styles */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            height: 100%;
            width: var(--sidebar-width);
            background: var(--sidebar-bg);
            border-right: 1px solid var(--border);
            padding: 1rem;
            transition: all 0.3s ease;
            z-index: 100;
        }

        .sidebar-logo {
            padding: 1rem;
            text-align: center;
            margin-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .sidebar-nav {
            list-style: none;
            padding: 0;
        }

        .nav-item {
            margin-bottom: 0.5rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 0.8rem 1rem;
            color: var(--text);
            text-decoration: none;
            border-radius: 6px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .dark-theme .nav-link {
            color: var(--dark-text);
        }

        .nav-link:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--primary-color);
            transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .dark-theme .nav-link:after {
            background: var(--dark-primary-color);
        }

        .nav-link:hover:after {
            width: 100%;
        }

        .nav-link i {
            margin-right: 0.8rem;
            font-size: 1.2rem;
        }

        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            padding: 2rem;
            min-height: 100vh;
            margin-top: var(--header-height);
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: var(--sidebar-width);
            right: 0;
            height: var(--header-height);
            background: var(--light-bg);
            border-bottom: 1px solid var(--light-border);
            padding: 0 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 99;
        }

        .dark-theme .header {
            background: var(--dark-bg);
            border-color: var(--dark-border);
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-top: calc(var(--header-height) + 2rem);
        }

        .stat-card {
            background: var(--light-card-bg);
            border: 1px solid var(--light-border);
            border-radius: 8px;
            padding: 1.5rem;
        }

        .dark-theme .stat-card {
            background: var(--dark-card-bg);
            border-color: var(--dark-border);
        }

        .stat-title {
            font-size: 0.9rem;
            color: var(--light-text-secondary);
            margin-bottom: 0.5rem;
        }

        .dark-theme .stat-title {
            color: var(--dark-text-secondary);
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 600;
        }

        /* Header buttons */
        .btn-icon {
            width: 48px;
            height: 48px;
            font-size: 1.5rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            border: none;
            background: transparent;
            color: var(--light-text);
            cursor: pointer;
            margin-left: 0.5rem;
        }

        .dark-theme .btn-icon {
            color: var(--dark-text);
        }

        .btn-icon:after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            background: var(--primary-color);
            opacity: 0;
            border-radius: 50%;
            transform: translate(-50%, -50%) scale(0);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s;
        }

        .btn-icon:hover:after {
            transform: translate(-50%, -50%) scale(1);
            opacity: 0.1;
        }

        /* Profile dropdown */
        .header-right {
            display: flex;
            align-items: center;
        }

        .profile-dropdown {
            position: relative;
            margin-left: 1rem;
        }

        .profile-btn {
            display: flex;
            align-items: center;
            padding: 0.5rem;
            border: none;
            background: transparent;
            cursor: pointer;
            color: var(--light-text);
        }

        .dark-theme .profile-btn {
            color: var(--dark-text);
        }

        .avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }

        .profile-name {
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .dropdown-menu {
            transform: translateY(10px);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: block;
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--light-card-bg);
            border: 1px solid var(--light-border);
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            min-width: 200px;
        }

        .dark-theme .dropdown-menu {
            background: var(--dark-card-bg);
            border-color: var(--dark-border);
        }

        .profile-dropdown:hover .dropdown-menu {
            transform: translateY(0);
            opacity: 1;
            visibility: visible;
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            color: var(--light-text);
            text-decoration: none;
            transition: background 0.2s;
        }

        .dark-theme .dropdown-item {
            color: var(--dark-text);
        }

        .dropdown-item:hover {
            background: var(--light-hover-bg);
        }

        .dark-theme .dropdown-item:hover {
            background: var(--dark-hover-bg);
        }

        .dropdown-item i {
            margin-right: 0.5rem;
            font-size: 1.1rem;
        }

        .dropdown-divider {
            height: 1px;
            background: var(--light-border);
            margin: 0.5rem 0;
        }

        .dark-theme .dropdown-divider {
            background: var(--dark-border);
        }

        .text-danger {
            color: var(--danger-color) !important;
        }

        /* Active nav link */
        .nav-link.active {
            background: var(--primary-color);
            color: var(--primary-text);
        }

        .dark-theme .nav-link.active {
            background: var(--dark-primary-color);
            color: var(--dark-primary-text);
        }

        /* Logo switching */
        .dark-theme .logo-light {
            display: none;
        }
        .dark-theme .logo-dark {
            display: block;
        }

        /* Логотип */
        .logo-link {
            text-decoration: none;
            font-size: 1.5rem;
            font-weight: 800;
            display: inline-block;
        }
        
        .logo-text-royal {
            color: #000000;
        }
        
        .dark-theme .logo-text-royal {
            color: #FFFFFF;
        }
        
        .logo-text-hub {
            background: #FF9000;
            color: #000000;
            padding: 2px 6px;
            border-radius: 3px;
        }

        /* Подменю */
        .submenu {
            list-style: none;
            padding-left: 3rem;
            height: 0;
            overflow: hidden;
            transition: height 0.3s ease-in-out;
            opacity: 0;
        }

        .has-submenu.active .submenu {
            height: auto;
            opacity: 1;
        }

        .submenu a {
            display: block;
            padding: 0.7rem 0;
            color: var(--light-text-secondary);
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.3s ease;
            opacity: 0.8;
        }

        .dark-theme .submenu a {
            color: var(--dark-text-secondary);
        }

        .submenu a:hover {
            color: var(--primary-color);
            opacity: 1;
        }

        .dark-theme .submenu a:hover {
            color: var(--dark-primary-color);
        }

        .has-submenu .submenu-arrow {
            margin-left: auto;
            transition: transform 0.3s ease;
            opacity: 0.7;
        }

        .has-submenu.active .submenu-arrow {
            transform: rotate(-180deg);
            opacity: 1;
        }

        /* Профиль без аватарки */
        .profile-icon {
            font-size: 2rem;
        }

        /* Увеличиваем иконки в шапке */
        .header .btn-icon {
            width: 48px;
            height: 48px;
            font-size: 1.5rem;
        }

        /* Мобильная поддержка */
        .mobile-toggle {
            display: none;
            font-size: 1.8rem;
            background: none;
            border: none;
            color: var(--light-text);
            cursor: pointer;
            padding: 0.5rem;
        }

        .dark-theme .mobile-toggle {
            color: var(--dark-text);
        }

        @media (max-width: 992px) {
            .profile-name {
                max-width: 120px;
            }
        }

        @media (max-width: 768px) {
            .profile-name {
                max-width: 0;
                display: none;
            }
            
            .profile-icon-mobile {
                display: inline-block;
                font-size: 1.5rem;
                margin-right: 0.5rem;
            }
            
            /* Показываем имя в выпадающем меню на мобильных */
            .dropdown-menu .profile-info {
                display: block;
                padding: 0.75rem 1rem;
                border-bottom: 1px solid var(--light-border);
                font-weight: 500;
            }

            .dark-theme .dropdown-menu .profile-info {
                border-color: var(--dark-border);
            }

            .sidebar {
                width: 100%;
                max-width: 280px;
                left: -100%;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.active {
                transform: translateX(0);
                left: 0;
            }

            .main-content {
                margin-left: 0;
                padding: 1rem;
            }

            .header {
                left: 0;
                padding: 0 1rem;
            }

            .header-right {
                gap: 0.5rem;
            }

            .btn-icon {
                width: 40px;
                height: 40px;
            }
            
            .mobile-toggle {
                display: block;
            }
            
            .overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.5);
                z-index: 99;
                display: none;
            }
            
            .overlay.active {
                display: block;
            }
        }

        @media (max-height: 600px) {
            .sidebar-nav {
                max-height: calc(100vh - 120px);
                overflow-y: auto;
            }

            .nav-link {
                padding: 0.6rem 1rem;
            }

            .submenu a {
                padding: 0.5rem 0;
            }

            .sidebar-logo {
                padding: 0.5rem;
                margin-bottom: 0.5rem;
            }
        }

        /* Улучшаем скроллбар для сайдбара */
        .sidebar-nav::-webkit-scrollbar {
            width: 4px;
        }

        .sidebar-nav::-webkit-scrollbar-track {
            background: transparent;
        }

        .sidebar-nav::-webkit-scrollbar-thumb {
            background: var(--light-border);
            border-radius: 2px;
        }

        .dark-theme .sidebar-nav::-webkit-scrollbar-thumb {
            background: var(--dark-border);
        }

        /* Стили для контента вопросов */
        .content-container {
            padding: 1.5rem;
            margin-top: 1rem;
        }

        /* Улучшенный раздел со статистикой */
        .dashboard-stats {
            background: var(--light-card-bg);
            border: 1px solid var(--light-border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.04);
        }

        .dark-theme .dashboard-stats {
            background: var(--dark-card-bg);
            border-color: var(--dark-border);
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }

        .stats-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .stats-header h3 {
            font-size: 1.2rem;
            font-weight: 600;
            margin: 0;
            color: var(--light-text);
        }

        .dark-theme .stats-header h3 {
            color: var(--dark-text);
        }

        .stats-toggle {
            display: flex;
            gap: 0.5rem;
        }

        .stats-toggle-btn {
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            border: 1px solid var(--light-border);
            background: var(--light-bg);
            color: var(--light-text);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .stats-toggle-btn.active {
            background: var(--primary-color);
            color: var(--primary-text);
            border-color: var(--primary-color);
        }

        .dark-theme .stats-toggle-btn {
            background: var(--dark-bg);
            color: var(--dark-text);
            border-color: var(--dark-border);
        }

        .dark-theme .stats-toggle-btn.active {
            background: var(--dark-primary-color);
            color: var(--dark-primary-text);
            border-color: var(--dark-primary-color);
        }

        /* Основные показатели */
        .main-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            padding: 1.2rem;
            border-radius: 10px;
            background: var(--light-bg);
            border: 1px solid var(--light-border);
            text-align: center;
            transition: transform 0.2s;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
        }

        .dark-theme .stat-card {
            background: var(--dark-bg);
            border-color: var(--dark-border);
        }

        .stat-number {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }

        .dark-theme .stat-number {
            color: var(--dark-primary-color);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--light-text-secondary);
        }

        .dark-theme .stat-label {
            color: var(--dark-text-secondary);
        }

        /* Детальная статистика */
        .detailed-stats {
            display: none;
            background: var(--light-bg);
            border: 1px solid var(--light-border);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .detailed-stats.active {
            display: block;
        }

        .dark-theme .detailed-stats {
            background: var(--dark-bg);
            border-color: var(--dark-border);
        }

        .stats-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid var(--light-border);
            padding-bottom: 0.5rem;
        }

        .dark-theme .stats-tabs {
            border-color: var(--dark-border);
        }

        .stats-tab {
            padding: 0.4rem 0.8rem;
            border-radius: 6px 6px 0 0;
            font-size: 0.9rem;
            cursor: pointer;
            color: var(--light-text-secondary);
            background: transparent;
            transition: all 0.2s;
            border: none;
        }

        .stats-tab.active {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            font-weight: 500;
        }

        .dark-theme .stats-tab {
            color: var(--dark-text-secondary);
        }

        .dark-theme .stats-tab.active {
            color: var(--dark-primary-color);
            border-color: var(--dark-primary-color);
        }

        /* Секции статистики */
        .stats-content {
            display: none;
        }

        .stats-content.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 0.8rem;
        }

        .stats-item {
            display: flex;
            flex-direction: column;
            padding: 0.8rem;
            border-radius: 6px;
            background: var(--light-card-bg);
            border: 1px solid var(--light-border);
            transition: all 0.2s;
        }

        .stats-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }

        .dark-theme .stats-item {
            background: var(--dark-card-bg);
            border-color: var(--dark-border);
        }

        .stats-item-title {
            font-size: 0.9rem;
            color: var(--light-text);
            margin-bottom: 0.5rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .dark-theme .stats-item-title {
            color: var(--dark-text);
        }

        .stats-item-count {
            padding: 0.3rem 0.5rem;
            background: var(--light-hover-bg);
            color: var(--light-text);
            border-radius: 4px;
            font-size: 0.85rem;
            align-self: flex-start;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .dark-theme .stats-item-count {
            background: var(--dark-hover-bg);
            color: var(--dark-text);
        }

        /* Улучшенные фильтры */
        .filters-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1.5rem;
            background: var(--light-card-bg);
            border: 1px solid var(--light-border);
            border-radius: 8px;
            padding: 1.2rem;
        }

        .filters-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-bottom: 0.8rem;
        }

        .filters-title {
            font-size: 1rem;
            font-weight: 500;
            color: var(--light-text);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .dark-theme .filters-title {
            color: var(--dark-text);
        }

        .filters-actions {
            display: flex;
            gap: 0.5rem;
        }

        .filter-row {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            width: 100%;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-width: 200px;
        }

        .filter-label {
            font-size: 0.85rem;
            color: var(--light-text-secondary);
            margin-bottom: 0.3rem;
        }

        .dark-theme .filter-label {
            color: var(--dark-text-secondary);
        }

        .toggle-filters {
            background: transparent;
            border: none;
            color: var(--light-text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.3rem;
            font-size: 0.9rem;
            padding: 0.4rem;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .toggle-filters:hover {
            color: var(--primary-color);
            background: var(--light-hover-bg);
        }

        .dark-theme .toggle-filters:hover {
            color: var(--dark-primary-color);
            background: var(--dark-hover-bg);
        }

        .advanced-filters {
            width: 100%;
            margin-top: 1rem;
            display: none;
        }

        .advanced-filters.active {
            display: block;
        }

        /* Переключатели медиа */
        .media-toggle {
            display: flex;
            border: 1px solid var(--light-border);
            border-radius: 6px;
            overflow: hidden;
        }

        .dark-theme .media-toggle {
            border-color: var(--dark-border);
        }

        .media-option {
            flex: 1;
            padding: 0.6rem 1rem;
            text-align: center;
            cursor: pointer;
            background: var(--light-bg);
            color: var(--light-text);
            border: none;
            transition: all 0.2s;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.4rem;
        }

        .media-option.active {
            background: var(--primary-color);
            color: var(--primary-text);
        }

        .dark-theme .media-option {
            background: var(--dark-bg);
            color: var(--dark-text);
        }

        .dark-theme .media-option.active {
            background: var(--dark-primary-color);
            color: var(--dark-primary-text);
        }

        .media-option:not(:last-child) {
            border-right: 1px solid var(--light-border);
        }

        .dark-theme .media-option:not(:last-child) {
            border-right-color: var(--dark-border);
        }

        /* Улучшенный поиск */
        .search-box {
            flex: 1;
            min-width: 250px;
            position: relative;
        }

        .search-box i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--light-text-secondary);
        }

        .dark-theme .search-box i {
            color: var(--dark-text-secondary);
        }

        .search-box input {
            width: 100%;
            padding: 0.7rem 1rem 0.7rem 2.5rem;
            border: 1px solid var(--light-border);
            border-radius: 6px;
            background: var(--light-bg);
            color: var(--light-text);
            font-size: 0.95rem;
            transition: all 0.2s;
        }

        .search-box input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(255, 144, 0, 0.2);
            outline: none;
        }

        .dark-theme .search-box input {
            background: var(--dark-bg);
            border-color: var(--dark-border);
            color: var(--dark-text);
        }

        .dark-theme .search-box input:focus {
            border-color: var(--dark-primary-color);
            box-shadow: 0 0 0 2px rgba(255, 215, 0, 0.2);
        }

        /* Селекты */
        .select-wrapper {
            position: relative;
            width: 100%;
        }

        .select-wrapper i {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--light-text-secondary);
            pointer-events: none;
        }

        .dark-theme .select-wrapper i {
            color: var(--dark-text-secondary);
        }

        .select-wrapper select {
            width: 100%;
            padding: 0.7rem 2.5rem 0.7rem 1rem;
            border: 1px solid var(--light-border);
            border-radius: 6px;
            background: var(--light-bg);
            color: var(--light-text);
            appearance: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .select-wrapper select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(255, 144, 0, 0.2);
            outline: none;
        }

        .dark-theme .select-wrapper select {
            background: var(--dark-bg);
            border-color: var(--dark-border);
            color: var(--dark-text);
        }

        .dark-theme .select-wrapper select:focus {
            border-color: var(--dark-primary-color);
            box-shadow: 0 0 0 2px rgba(255, 215, 0, 0.2);
        }

        /* Кнопки фильтров */
        .btn-filter {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.7rem 1rem;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-apply {
            background: var(--primary-color);
            color: var(--primary-text);
            border: none;
        }

        .btn-apply:hover {
            background: #e67e00;
        }

        .dark-theme .btn-apply {
            background: var(--dark-primary-color);
            color: var(--dark-primary-text);
        }

        .dark-theme .btn-apply:hover {
            background: #e6c200;
        }

        .btn-reset {
            background: transparent;
            color: var(--light-text);
            border: 1px solid var(--light-border);
        }

        .btn-reset:hover {
            background: var(--light-hover-bg);
        }

        .dark-theme .btn-reset {
            color: var(--dark-text);
            border-color: var(--dark-border);
        }

        .dark-theme .btn-reset:hover {
            background: var(--dark-hover-bg);
        }

        /* Категории */
        .category-tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
            margin-top: 1rem;
            width: 100%;
        }

        .category-tag {
            display: inline-flex;
            align-items: center;
            background: var(--light-accent);
            color: var(--light-accent-text);
            padding: 0.3rem 0.6rem;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .category-tag:hover {
            background: var(--primary-color);
            color: var(--primary-text);
            transform: translateY(-2px);
        }

        .dark-theme .category-tag {
            background: var(--dark-hover-bg);
            color: var(--dark-text);
        }
        
        .dark-theme .category-tag:hover {
            background: var(--dark-primary-color);
            color: var(--dark-primary-text);
        }
        
        .category-tag.active {
            background: var(--primary-color);
            color: var(--primary-text);
        }
        
        .dark-theme .category-tag.active {
            background: var(--dark-primary-color);
            color: var(--dark-primary-text);
        }

        /* Уведомления */
        .notification-container {
            position: fixed;
            top: 80px;
            right: 20px;
            width: 320px;
            max-width: 90%;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .notification {
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            display: flex;
            align-items: flex-start;
            transform: translateX(120%);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            animation: slide-in 0.3s forwards;
        }

        .notification.closing {
            animation: slide-out 0.3s forwards;
        }

        @keyframes slide-in {
            from {
                transform: translateX(120%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slide-out {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(120%);
                opacity: 0;
            }
        }

        .notification-content {
            flex: 1;
            margin-right: 10px;
        }

        .notification-title {
            font-weight: 600;
            margin: 0;
            margin-bottom: 0.3rem;
            font-size: 0.95rem;
        }

        .notification-message {
            margin: 0;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.85rem;
        }

        .notification-close {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            font-size: 1.1rem;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.2s;
        }

        .notification-close:hover {
            color: rgba(255, 255, 255, 1);
        }

        .notification-success {
            background: linear-gradient(to right, #43A047, #2E7D32);
            color: white;
        }

        .notification-error {
            background: linear-gradient(to right, #E53935, #C62828);
            color: white;
        }

        .notification-warning {
            background: linear-gradient(to right, #FB8C00, #EF6C00);
            color: white;
        }

        .notification-info {
            background: linear-gradient(to right, #039BE5, #0277BD);
            color: white;
        }

        /* Реальный прогресс бар для загрузки */
        .real-progress-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            z-index: 2000;
            background: transparent;
            overflow: hidden;
            display: none;
        }

        .real-progress-bar {
            height: 100%;
            width: 0;
            background: linear-gradient(to right, #FF9000, #FFD700);
            position: absolute;
            top: 0;
            left: 0;
            transition: width 0.1s linear;
            box-shadow: 0 0 10px rgba(255, 144, 0, 0.7);
        }

        .real-progress-pulsate {
            position: absolute;
            top: 0;
            right: 0;
            height: 100%;
            width: 100px;
            background: linear-gradient(to right, rgba(255, 144, 0, 0), rgba(255, 144, 0, 0.5));
            animation: pulsate 1.5s ease-out infinite;
        }

        @keyframes pulsate {
            0% {
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
            100% {
                opacity: 0;
            }
        }

        /* Исправление тёмной темы для фильтров */
        .dark-theme .filters-container,
        .dark-theme .dashboard-stats,
        .dark-theme .question-card,
        .dark-theme .no-results {
            background: var(--dark-card-bg);
            border-color: var(--dark-border);
        }

        /* Унификация размеров элементов */
        .question-card {
            min-height: 120px;
            display: flex;
            flex-direction: column;
            padding: 1.2rem;
            border-radius: 8px;
            background: var(--light-card-bg);
            border: 1px solid var(--light-border);
            margin-bottom: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.04);
            transition: all 0.2s ease;
        }
        
        .question-card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.08);
            transform: translateY(-2px);
        }
        
        .dark-theme .question-card {
            background: var(--dark-card-bg);
            border-color: var(--dark-border);
            box-shadow: 0 2px 4px rgba(0,0,0,0.12);
        }
        
        .dark-theme .question-card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.16);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 0.8rem;
            padding-bottom: 0.8rem;
            border-bottom: 1px solid var(--light-border);
        }
        
        .dark-theme .question-header {
            border-color: var(--dark-border);
        }

        .question-header h3 {
            margin: 0;
            font-size: 1.1rem;
            color: var(--light-text);
            flex: 1;
            line-height: 1.4;
        }
        
        .dark-theme .question-header h3 {
            color: var(--dark-text);
        }
        
        .question-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: 6px;
            border: 1px solid var(--light-border);
            background: var(--light-bg);
            color: var(--light-text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .action-btn:hover {
            background: var(--light-hover-bg);
            color: var(--primary-color);
        }
        
        .action-btn.toggle-btn {
            transform: translateY(0);
        }
        
        .action-btn.toggle-btn.active {
            transform: rotate(180deg);
        }
        
        .action-btn.edit-btn:hover {
            color: #2196F3;
            border-color: #2196F3;
        }
        
        .action-btn.delete-btn:hover {
            color: #F44336;
            border-color: #F44336;
        }
        
        .dark-theme .action-btn {
            background: var(--dark-bg);
            border-color: var(--dark-border);
            color: var(--dark-text-secondary);
        }
        
        .dark-theme .action-btn:hover {
            background: var(--dark-hover-bg);
            color: var(--dark-primary-color);
        }
        
        .dark-theme .action-btn.edit-btn:hover {
            color: #42A5F5;
            border-color: #42A5F5;
        }
        
        .dark-theme .action-btn.delete-btn:hover {
            color: #EF5350;
            border-color: #EF5350;
        }

        .meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: auto;
            padding-top: 0.8rem;
        }
        
        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: var(--light-text-secondary);
        }
        
        .dark-theme .meta-item {
            color: var(--dark-text-secondary);
        }
        
        .uid {
            padding: 0.3rem 0.6rem;
            background: var(--light-accent);
            color: var(--light-accent-text);
            border-radius: 4px;
            font-size: 0.8rem;
            font-family: monospace;
        }
        
        .dark-theme .uid {
            background: var(--dark-hover-bg);
            color: var(--dark-text);
        }
        
        /* Стили для деталей вопроса */
        .details {
            display: none;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--light-border);
        }
        
        .dark-theme .details {
            border-color: var(--dark-border);
        }
        
        .question-details {
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
        }
        
        .details-section {
            background: var(--light-bg);
            border-radius: 6px;
            padding: 1rem;
            border: 1px solid var(--light-border);
        }
        
        .dark-theme .details-section {
            background: var(--dark-bg);
            border-color: var(--dark-border);
        }
        
        .details-section h4 {
            margin: 0 0 0.8rem 0;
            font-size: 1rem;
            color: var(--light-text);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .dark-theme .details-section h4 {
            color: var(--dark-text);
        }
        
        .details-row {
            display: flex;
            margin-bottom: 0.6rem;
        }
        
        .details-label {
            flex: 0 0 120px;
            font-weight: 500;
            color: var(--light-text-secondary);
        }
        
        .dark-theme .details-label {
            color: var(--dark-text-secondary);
        }
        
        .details-value {
            flex: 1;
        }
        
        .options-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .option {
            padding: 0.7rem;
            border-radius: 4px;
            background: var(--light-hover-bg);
            border-left: 3px solid transparent;
        }
        
        .dark-theme .option {
            background: var(--dark-hover-bg);
        }
        
        .option.correct {
            background: rgba(76, 175, 80, 0.1);
            border-left-color: #4CAF50;
        }
        
        .dark-theme .option.correct {
            background: rgba(76, 175, 80, 0.2);
        }
        
        /* Прогресс-бар для деталей */
        .progress-bar {
            width: 100%;
            height: 4px;
            background: var(--light-hover-bg);
            margin: 1rem 0;
            overflow: hidden;
            border-radius: 2px;
        }
        
        .dark-theme .progress-bar {
            background: var(--dark-hover-bg);
        }
        
        .progress-bar-inner {
            height: 100%;
            width: 0;
            background: var(--primary-color);
            animation: indeterminate 1.5s infinite linear;
            transform-origin: 0% 50%;
        }
        
        @keyframes indeterminate {
            0% { transform: translateX(0) scaleX(0); }
            40% { transform: translateX(0) scaleX(0.4); }
            100% { transform: translateX(100%) scaleX(0.5); }
        }
        
        .dark-theme .progress-bar-inner {
            background: var(--dark-primary-color);
        }
        
        /* Overlay для действий с прогресс-баром */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(3px);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            width: 90%;
            max-width: 400px;
            background: var(--light-card-bg);
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .dark-theme .modal-content {
            background: var(--dark-card-bg);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.25);
        }
        
        .modal-spinner {
            width: 60px;
            height: 60px;
            margin: 0 auto 1.5rem;
            border: 4px solid rgba(255, 144, 0, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s linear infinite;
        }
        
        .dark-theme .modal-spinner {
            border-color: rgba(255, 215, 0, 0.1);
            border-top-color: var(--dark-primary-color);
        }
        
        .modal-text {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--light-text);
        }
        
        .dark-theme .modal-text {
            color: var(--dark-text);
        }
        
        .modal-progress {
            height: 6px;
            background: var(--light-hover-bg);
            border-radius: 3px;
            margin: 1.5rem 0;
            overflow: hidden;
        }
        
        .dark-theme .modal-progress {
            background: var(--dark-hover-bg);
        }
        
        .modal-progress-bar {
            height: 100%;
            width: 0;
            background: var(--primary-color);
            transition: width 0.3s ease;
        }
        
        .dark-theme .modal-progress-bar {
            background: var(--dark-primary-color);
        }
        
        .modal-cancel {
            padding: 0.7rem 1.2rem;
            background: transparent;
            border: 1px solid var(--light-border);
            border-radius: 6px;
            color: var(--light-text);
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .modal-cancel:hover {
            background: var(--light-hover-bg);
        }
        
        .dark-theme .modal-cancel {
            border-color: var(--dark-border);
            color: var(--dark-text);
        }
        
        .dark-theme .modal-cancel:hover {
            background: var(--dark-hover-bg);
        }

        /* Индикатор загрузки для вопросов */
        .questions-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem 0;
            background: var(--light-card-bg);
            border: 1px solid var(--light-border);
            border-radius: 12px;
            margin-bottom: 1.2rem;
        }

        .dark-theme .questions-loading {
            background: var(--dark-card-bg);
            border-color: var(--dark-border);
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(0,0,0,0.1);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 1rem;
        }

        .dark-theme .spinner {
            border-color: rgba(255,255,255,0.1);
            border-top-color: var(--dark-primary-color);
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .loading-text {
            font-size: 1rem;
            color: var(--light-text-secondary);
        }

        .dark-theme .loading-text {
            color: var(--dark-text-secondary);
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            background: var(--light-card-bg);
            border: 1px solid var(--light-border);
            border-radius: 12px;
            padding: 1.2rem 1.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.04);
        }

        .dark-theme .page-header {
            background: var(--dark-card-bg);
            border-color: var(--dark-border);
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }

        .page-header h1 {
            font-size: 1.8rem;
            font-weight: 600;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--light-text);
        }

        .dark-theme .page-header h1 {
            color: var(--dark-text);
        }

        .page-header h1 i {
            font-size: 2rem;
            color: var(--primary-color);
        }

        .dark-theme .page-header h1 i {
            color: var(--dark-primary-color);
        }

        .page-actions {
            display: flex;
            gap: 0.8rem;
        }

        .btn-primary {
            background: var(--primary-color);
            color: var(--primary-text);
            border: none;
            padding: 0.7rem 1.2rem;
            font-size: 0.95rem;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
            text-decoration: none;
            transition: all 0.2s ease;
            box-shadow: 0 4px 8px rgba(255, 144, 0, 0.2);
        }
        
        .btn-primary:hover {
            background: #e67e00;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(255, 144, 0, 0.3);
        }
        
        .dark-theme .btn-primary {
            background: var(--dark-primary-color);
            color: var(--dark-primary-text);
            box-shadow: 0 4px 8px rgba(255, 215, 0, 0.15);
        }
        
        .dark-theme .btn-primary:hover {
            background: #e6c200;
            box-shadow: 0 6px 12px rgba(255, 215, 0, 0.25);
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-logo">
            <a href="#" class="logo-link">
                <span class="logo-text-royal">Royal</span>
                <span class="logo-text-hub">Hub</span>
            </a>
        </div>
        <ul class="sidebar-nav">
            <li class="nav-item">
                <a href="#" class="nav-link active">
                    <i class='bx bxs-dashboard'></i>
                    <span>Дашборд</span>
                </a>
            </li>
            <li class="nav-item has-submenu">
                <a href="#" class="nav-link">
                    <i class='bx bx-user'></i>
                    <span>Пользователи</span>
                    <i class='bx bx-chevron-down submenu-arrow'></i>
                </a>
                <ul class="submenu">
                    <li><a href="#">Список пользователей</a></li>
                </ul>
            </li>
            <li class="nav-item has-submenu">
                <a href="#" class="nav-link">
                    <i class='bx bx-test-tube'></i>
                    <span>Тесты</span>
                    <i class='bx bx-chevron-down submenu-arrow'></i>
                </a>
                <ul class="submenu">
                    <li><a href="#">Список вопросов</a></li>
                    <li><a href="#">Лобби</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link">
                    <i class='bx bx-money'></i>
                    <span>Подписки</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link">
                    <i class='bx bx-link'></i>
                    <span>Рефералы</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link">
                    <i class='bx bx-wallet'></i>
                    <span>Транзакции</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link">
                    <i class='bx bx-cog'></i>
                    <span>Администрирование</span>
                </a>
            </li>
        </ul>
    </div>

    <div class="main-content">
        <header class="header">
            <div class="header-left">
                <button class="mobile-toggle">
                    <i class='bx bx-menu'></i>
                </button>
            </div>
            <div class="header-right">
                <button class="btn btn-icon">
                    <i class='bx bx-bell'></i>
                </button>
                <button id="theme-toggle" class="btn btn-icon">
                    <i class='bx bx-moon'></i>
                </button>
                <div class="profile-dropdown">
                    <button class="profile-btn">
                        <i class='bx bx-user profile-icon-mobile'></i>
                        <span class="profile-name">Иванов Иван Иванович</span>
                        <i class='bx bx-chevron-down'></i>
                    </button>
                    <div class="dropdown-menu">
                        <div class="profile-info">Иванов Иван Иванович</div>
                        <a href="#" class="dropdown-item">
                            <i class='bx bx-user'></i>
                            <span>Профиль</span>
                        </a>
                        <a href="#" class="dropdown-item">
                            <i class='bx bx-cog'></i>
                            <span>Настройки</span>
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item text-danger">
                            <i class='bx bx-log-out'></i>
                            <span>Выход</span>
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Вопросы - основной контент -->
        <div class="content-container">
            <div class="page-header">
                <h1><i class='bx bx-question-mark'></i> Вопросы</h1>
                <div class="page-actions">
                    <a href="/add_question.html" class="btn-primary">
                        <i class='bx bx-plus'></i> Добавить вопрос
                    </a>
                </div>
            </div>

            <!-- Улучшенная статистика -->
            <div class="dashboard-stats">
                <div class="stats-header">
                    <h3><i class='bx bx-stats'></i> Статистика вопросов</h3>
                    <div class="stats-toggle">
                        <button class="stats-toggle-btn active" data-target="main-stats">Общая</button>
                        <button class="stats-toggle-btn" data-target="detailed-stats">Детальная</button>
                    </div>
                </div>
                
                <!-- Основная статистика -->
                <div class="main-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalQuestions">0</div>
                        <div class="stat-label">Всего вопросов</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="withMediaCount">0</div>
                        <div class="stat-label">С медиа</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="categoriesCount">0</div>
                        <div class="stat-label">Категорий</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="sectionsCount">0</div>
                        <div class="stat-label">Разделов ПДД</div>
                    </div>
                </div>
                
                <!-- Детальная статистика -->
                <div class="detailed-stats">
                    <div class="stats-tabs">
                        <button class="stats-tab active" data-target="category-stats">По категориям</button>
                        <button class="stats-tab" data-target="section-stats">По разделам ПДД</button>
                    </div>
                    
                    <!-- Статистика по категориям -->
                    <div class="stats-content active" id="category-stats">
                        <div class="stats-grid" id="categoriesStatsGrid"></div>
                    </div>
                    
                    <!-- Статистика по разделам ПДД -->
                    <div class="stats-content" id="section-stats">
                        <div class="stats-grid" id="sectionsStatsGrid"></div>
                    </div>
                </div>
            </div>

            <!-- Улучшенные фильтры -->
            <div class="filters-container">
                <div class="filters-header">
                    <div class="filters-title">
                        <i class='bx bx-filter-alt'></i> Фильтры
                    </div>
                </div>
                
                <!-- Основные фильтры -->
                <div class="filter-row">
                    <div class="search-box">
                        <i class='bx bx-search'></i>
                        <input type="text" id="searchInput" placeholder="Поиск по тексту вопроса...">
                    </div>
                    
                    <div class="filter-group">
                        <div class="filter-label">Медиа</div>
                        <div class="media-toggle">
                            <button class="media-option active" data-value="">
                                <i class='bx bx-list-ul'></i> Все
                            </button>
                            <button class="media-option" data-value="true">
                                <i class='bx bx-image'></i> С медиа
                            </button>
                            <button class="media-option" data-value="false">
                                <i class='bx bx-image-alt'></i> Без медиа
                            </button>
                        </div>
                    </div>
                    
                    <button class="btn-filter btn-reset" id="resetFilters">
                        <i class='bx bx-reset'></i> Сбросить
                    </button>
                </div>
                
                <!-- Фильтр по категориям водительских прав -->
                <div class="filter-row">
                    <div class="filter-group" style="flex: 2;">
                        <div class="filter-label">Категории</div>
                        <div class="category-tags-container" id="categoryTags">
                            <!-- Категории будут добавлены через JavaScript -->
                        </div>
                    </div>
                    
                    <div class="filter-group">
                        <div class="filter-label">Раздел ПДД</div>
                        <div class="select-wrapper">
                            <select id="sectionFilter">
                                <option value="">Все разделы</option>
                            </select>
                            <i class='bx bx-chevron-down'></i>
                        </div>
                    </div>
                    
                    <button class="btn-filter btn-apply" id="applyFilters">
                        <i class='bx bx-check'></i> Применить
                    </button>
                </div>
            </div>

            <!-- Индикатор загрузки для вопросов -->
            <div class="questions-loading" id="questionsLoading">
                <div class="spinner"></div>
                <div class="loading-text">Загрузка вопросов...</div>
                <div class="progress-container" style="width: 80%; max-width: 500px; margin-top: 15px;">
                    <div class="progress-bar-wrapper" style="width: 100%; height: 8px; background: rgba(0,0,0,0.1); border-radius: 4px; overflow: hidden;">
                        <div class="progress-bar-inner" id="loadingProgressBar" style="width: 0%; height: 100%; background: var(--primary-color); transition: width 0.3s ease;"></div>
                    </div>
                    <div class="progress-text" id="progressPercentage" style="text-align: center; margin-top: 5px; font-size: 0.9rem; color: var(--light-text-secondary);"></div>
                </div>
            </div>

            <!-- Список вопросов -->
            <div id="questionsContainer" style="display: none;"></div>

            <!-- Пагинация -->
            <div class="pagination" id="pagination" style="display: none;">
                <!-- Пагинация будет добавлена через JavaScript -->
            </div>
        </div>
    </div>

    <div class="overlay"></div>
    
    <!-- Контейнер для уведомлений -->
    <div class="notification-container" id="notificationContainer"></div>
    
    <!-- Реальный прогресс бар -->
    <div class="real-progress-container" id="realProgressContainer">
        <div class="real-progress-bar" id="realProgressBar">
            <div class="real-progress-pulsate"></div>
        </div>
    </div>
    
    <!-- Модальное окно для загрузки с прогресс-баром -->
    <div class="modal-overlay" id="loadingModal">
        <div class="modal-content">
            <div class="modal-spinner"></div>
            <div class="modal-text" id="modalText">Загрузка данных...</div>
            <div class="modal-progress">
                <div class="modal-progress-bar" id="modalProgressBar"></div>
            </div>
            <div id="modalPercentage">0%</div>
            <button class="modal-cancel" id="modalCancel">Отмена</button>
        </div>
    </div>

    <script>
        // Обновленная обработка подменю
        document.querySelectorAll('.has-submenu').forEach(item => {
            const submenu = item.querySelector('.submenu');
            const link = item.querySelector('.nav-link');
            
            // Устанавливаем начальную высоту
            if (item.classList.contains('active')) {
                submenu.style.height = submenu.scrollHeight + 'px';
            }

            link.addEventListener('click', (e) => {
                e.preventDefault();
                const isActive = item.classList.contains('active');
                
                // Закрываем все другие подменю
                document.querySelectorAll('.has-submenu.active').forEach(activeItem => {
                    if (activeItem !== item) {
                        activeItem.classList.remove('active');
                        activeItem.querySelector('.submenu').style.height = '0';
                    }
                });

                // Переключаем текущее подменю
                if (isActive) {
                    submenu.style.height = '0';
                    item.classList.remove('active');
                } else {
                    submenu.style.height = submenu.scrollHeight + 'px';
                    item.classList.add('active');
                }
            });
        });

        // Обработка изменения размера окна
        window.addEventListener('resize', () => {
            document.querySelectorAll('.has-submenu.active .submenu').forEach(submenu => {
                submenu.style.height = submenu.scrollHeight + 'px';
            });
        });

        // Существующий код для переключения темы
        const themeToggle = document.getElementById('theme-toggle');
        const body = document.body;

        themeToggle.addEventListener('click', () => {
            body.classList.toggle('dark-theme');
            const icon = themeToggle.querySelector('i');
            if (body.classList.contains('dark-theme')) {
                icon.classList.replace('bx-moon', 'bx-sun');
            } else {
                icon.classList.replace('bx-sun', 'bx-moon');
            }
        });

        // Добавляем к существующему JavaScript
        const mobileToggle = document.querySelector('.mobile-toggle');
        const sidebar = document.querySelector('.sidebar');
        const overlay = document.querySelector('.overlay');

        mobileToggle.addEventListener('click', () => {
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        });

        overlay.addEventListener('click', () => {
            sidebar.classList.remove('active');
            overlay.classList.remove('active');
        });

        // Закрывать меню при клике на пункт меню на мобильных устройствах
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', () => {
                if (window.innerWidth <= 768) {
                    // Не закрываем сайдбар при клике на пункты с подменю
                    if (!link.closest('.has-submenu')) {
                        sidebar.classList.remove('active');
                        overlay.classList.remove('active');
                    }
                }
            });
        });
    </script>

    <!-- Добавляем скрипт для работы с вопросами -->
    <script>
        // Глобальные переменные для работы с данными и фильтрами
        let allQuestions = [];
        let filteredQuestions = [];
        let categories = new Set();
        let pddSections = [];
        let categoryStats = {};
        let sectionStats = {};
        let currentPage = 1;
        const itemsPerPage = 10;
        let isLoading = false;
        let selectedCategoryTag = '';

        // Данные о разделах ПДД из .env
        const PDD_SECTIONS = [
            {"uid":"polozheniya","title":"Общие положения","order":10},
            {"uid":"voditeli","title":"Общие обязанности водителей","order":20},
            {"uid":"peshehody","title":"Обязанности пешеходов","order":30},
            {"uid":"passazhiry","title":"Обязанности пассажиров","order":40},
            {"uid":"svetofor","title":"Сигналы светофора и регулировщика","order":50},
            {"uid":"specsignaly","title":"Применение специальных сигналов","order":60},
            {"uid":"avarijka","title":"Применение аварийной сигнализации и знака аварийной остановки","order":70},
            {"uid":"manevrirovanie","title":"Маневрирование","order":80},
            {"uid":"raspolozhenie","title":"Расположение транспортных средств на проезжей части дороги","order":90},
            {"uid":"speed","title":"Скорость движения","order":100},
            {"uid":"obgon","title":"Обгон, встречный разъезд","order":110},
            {"uid":"ostanovka","title":"Остановка и стоянка","order":120},
            {"uid":"perekrestki","title":"Проезд перекрёстков","order":130},
            {"uid":"perehody","title":"Пешеходные переходы и остановки маршрутных транспортных средств","order":140},
            {"uid":"zhd","title":"Движение через железнодорожные пути","order":150},
            {"uid":"magistral","title":"Движение по автомагистралям","order":160},
            {"uid":"zhilaya-zona","title":"Движение в жилых зонах","order":170},
            {"uid":"prioritet","title":"Приоритет маршрутных транспортных средств","order":180},
            {"uid":"svetovye-pribory","title":"Пользование внешними световыми приборами и звуковыми сигналами","order":190},
            {"uid":"buksirovka","title":"Буксировка механических транспортных средств","order":200},
            {"uid":"uchebnaya-ezda","title":"Учебная езда","order":210},
            {"uid":"perevozka-passazhirov","title":"Перевозка пассажиров","order":220},
            {"uid":"perevozka-gruzov","title":"Перевозка грузов","order":230},
            {"uid":"velosipedy-i-zhivotnye","title":"Дополнительные требования к движению велосипедов, мопедов, гужевых повозок, а так же животных","order":240},
            {"uid":"invalidy","title":"Обеспечение движения людей с нарушениями опорно-двигательного аппарата","order":250},
            {"uid":"znaki","title":"Дорожные знаки","order":260},
            {"uid":"razmetka","title":"Дорожная разметка и её характеристики","order":270},
            {"uid":"dopusk","title":"Основные положения по допуску транспортных средств к эксплуатации","order":280},
            {"uid":"obdzh","title":"ОБДЖ (Обеспечение безопасности дорожного движения)","order":290},
            {"uid":"administrativka","title":"Административка","order":300},
            {"uid":"medicina","title":"Медицина","order":310},
            {"uid":"dtp","title":"ДТП","order":320}
        ];

        // Категории водительских прав
        const PDD_CATEGORIES = ["A1","A","B1","B","BE","C","C1","BC1","D1","D","Tb","CE", "DE"];

        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', async () => {
            initializeUI();
            initCategoryTags();
            await fetchAllQuestions();
            setupEventListeners();
        });

        // Инициализация UI элементов
        function initializeUI() {
            // Заполняем выпадающий список разделов ПДД
            const sectionFilter = document.getElementById('sectionFilter');
            sectionFilter.innerHTML = '<option value="">Все разделы</option>';
            
            PDD_SECTIONS.forEach(section => {
                const option = document.createElement('option');
                option.value = section.uid;
                option.textContent = section.title;
                sectionFilter.appendChild(option);
            });
        }

        // Инициализация тегов категорий
        function initCategoryTags() {
            const tagsContainer = document.getElementById('categoryTags');
            tagsContainer.innerHTML = '<div class="category-tag active" data-category="">Все категории</div>';
            
            PDD_CATEGORIES.forEach(category => {
                const tag = document.createElement('div');
                tag.className = 'category-tag';
                tag.setAttribute('data-category', category);
                tag.textContent = category;
                tag.addEventListener('click', () => selectCategoryTag(category));
                tagsContainer.appendChild(tag);
            });
        }

        // Обработка выбора тега категории
        function selectCategoryTag(category) {
            // Удаляем активный класс со всех тегов
            document.querySelectorAll('.category-tag').forEach(tag => {
                tag.classList.remove('active');
            });
            
            // Активируем выбранный тег
            const selectedTag = document.querySelector(`.category-tag[data-category="${category}"]`) || 
                               document.querySelector('.category-tag[data-category=""]');
            selectedTag.classList.add('active');
            
            // Обновляем выбранную категорию
            selectedCategoryTag = category;
            
            // Применяем фильтр
            currentPage = 1;
            applyFilters();
        }

        // Настраиваем обработчики событий
        function setupEventListeners() {
            // Обработчики для фильтров и поиска
            document.getElementById('searchInput').addEventListener('input', () => {
                currentPage = 1;
                applyFilters();
            });
            
            // Обработчики для переключателей медиа
            document.querySelectorAll('.media-option').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.media-option').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentPage = 1;
                    applyFilters();
                });
            });
            
            // Обработчик раздела ПДД
            document.getElementById('sectionFilter').addEventListener('change', applyFilters);
            
            // Кнопки фильтров
            document.getElementById('resetFilters').addEventListener('click', resetFilters);
            document.getElementById('applyFilters').addEventListener('click', () => {
                currentPage = 1;
                applyFilters();
            });
            
            // Переключение статистики
            document.querySelectorAll('.stats-toggle-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const target = btn.getAttribute('data-target');
                    
                    // Активируем кнопку
                    document.querySelectorAll('.stats-toggle-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    // Показываем нужный контент
                    if (target === 'main-stats') {
                        document.querySelector('.main-stats').style.display = 'grid';
                        document.querySelector('.detailed-stats').classList.remove('active');
                    } else {
                        document.querySelector('.main-stats').style.display = 'none';
                        document.querySelector('.detailed-stats').classList.add('active');
                    }
                });
            });
            
            // Переключение вкладок с детальной статистикой
            document.querySelectorAll('.stats-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const target = tab.getAttribute('data-target');
                    
                    // Активируем вкладку
                    document.querySelectorAll('.stats-tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Показываем нужный контент
                    document.querySelectorAll('.stats-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(target).classList.add('active');
                });
            });
        }

        // Управление реальным прогрессом загрузки
        const ProgressBar = {
            element: null,
            container: null,
            currentProgress: 0,
            requestId: null,
            autoIncrement: true,
            throttleTimeout: null,
            modalProgressBar: null,
            modalPercentage: null,
            
            init() {
                this.container = document.getElementById('realProgressContainer');
                this.element = document.getElementById('realProgressBar');
                this.modalProgressBar = document.getElementById('modalProgressBar');
                this.modalPercentage = document.getElementById('modalPercentage');
            },
            
            start() {
                this.currentProgress = 0;
                this.autoIncrement = true;
                this.container.style.display = 'block';
                this.element.style.width = '0%';
                
                // Запускаем автоинкремент
                this.autoIncrementProgress();
                
                // Инициализируем прогресс в модальном окне
                if (this.modalProgressBar) {
                    this.modalProgressBar.style.width = '0%';
                    this.modalPercentage.textContent = '0%';
                }
            },
            
            update(progress) {
                if (!this.container) this.init();
                
                // Останавливаем автоинкремент если получили реальный прогресс
                if (progress > 0) {
                    this.autoIncrement = false;
                    cancelAnimationFrame(this.requestId);
                }
                
                // Ограничиваем обновления для плавности
                if (this.throttleTimeout) return;
                
                this.throttleTimeout = setTimeout(() => {
                    this.throttleTimeout = null;
                    this.currentProgress = progress;
                    this.element.style.width = `${progress}%`;
                    
                    // Обновляем прогресс в модальном окне
                    if (this.modalProgressBar) {
                        this.modalProgressBar.style.width = `${progress}%`;
                        this.modalPercentage.textContent = `${Math.round(progress)}%`;
                    }
                    
                    // Обновляем текст в любом другом индикаторе прогресса
                    const progressPercentage = document.getElementById('progressPercentage');
                    if (progressPercentage) {
                        progressPercentage.textContent = `Загружено: ${Math.round(progress)}%`;
                    }
                    
                    const loadingProgressBar = document.getElementById('loadingProgressBar');
                    if (loadingProgressBar) {
                        loadingProgressBar.style.width = `${progress}%`;
                    }
                }, 50);
            },
            
            complete() {
                this.update(100);
                setTimeout(() => {
                    this.container.style.display = 'none';
                    
                    // Закрываем модальное окно
                    const modal = document.getElementById('loadingModal');
                    if (modal && modal.classList.contains('active')) {
                        modal.classList.remove('active');
                    }
                }, 500);
            },
            
            autoIncrementProgress() {
                if (!this.autoIncrement) return;
                
                const incrementAmount = Math.max(0.5, (100 - this.currentProgress) / 50);
                this.currentProgress = Math.min(99, this.currentProgress + incrementAmount * (Math.random() * 0.3 + 0.2));
                this.element.style.width = `${this.currentProgress}%`;
                
                // Обновляем прогресс в модальном окне
                if (this.modalProgressBar) {
                    this.modalProgressBar.style.width = `${this.currentProgress}%`;
                    this.modalPercentage.textContent = `${Math.round(this.currentProgress)}%`;
                }
                
                // Обновляем текст в любом другом индикаторе прогресса
                const progressPercentage = document.getElementById('progressPercentage');
                if (progressPercentage) {
                    progressPercentage.textContent = `Загружено: ${Math.round(this.currentProgress)}%`;
                }
                
                const loadingProgressBar = document.getElementById('loadingProgressBar');
                if (loadingProgressBar) {
                    loadingProgressBar.style.width = `${this.currentProgress}%`;
                }
                
                if (this.currentProgress < 99) {
                    this.requestId = requestAnimationFrame(() => this.autoIncrementProgress());
                }
            },
            
            showModalProgress(message = 'Загрузка данных...') {
                const modal = document.getElementById('loadingModal');
                const modalText = document.getElementById('modalText');
                
                if (modal && modalText) {
                    modalText.textContent = message;
                    modal.classList.add('active');
                    
                    // Подключаем обработчик отмены
                    const cancelBtn = document.getElementById('modalCancel');
                    if (cancelBtn) {
                        cancelBtn.addEventListener('click', this.closeModal);
                    }
                }
            },
            
            closeModal() {
                const modal = document.getElementById('loadingModal');
                if (modal) {
                    modal.classList.remove('active');
                }
            }
        };

        // Система уведомлений
        const Notification = {
            container: null,
            timeouts: {},
            
            init() {
                this.container = document.getElementById('notificationContainer');
            },
            
            show(options) {
                if (!this.container) this.init();
                
                const { title, message, type = 'info', duration = 5000, id = Date.now() } = options;
                
                // Создаем элемент уведомления
                const notification = document.createElement('div');
                notification.className = `notification notification-${type}`;
                notification.id = `notification-${id}`;
                
                notification.innerHTML = `
                    <div class="notification-content">
                        <h3 class="notification-title">${title}</h3>
                        <p class="notification-message">${message}</p>
                    </div>
                    <button class="notification-close" aria-label="Закрыть">
                        <i class='bx bx-x'></i>
                    </button>
                `;
                
                // Добавляем в контейнер
                this.container.prepend(notification);
                
                // Настраиваем кнопку закрытия
                const closeBtn = notification.querySelector('.notification-close');
                closeBtn.addEventListener('click', () => this.close(id));
                
                // Устанавливаем автоматическое закрытие
                if (duration > 0) {
                    this.timeouts[id] = setTimeout(() => this.close(id), duration);
                }
                
                return id;
            },
            
            close(id) {
                const notification = document.getElementById(`notification-${id}`);
                if (!notification) return;
                
                // Отменяем таймаут
                if (this.timeouts[id]) {
                    clearTimeout(this.timeouts[id]);
                    delete this.timeouts[id];
                }
                
                // Запускаем анимацию закрытия
                notification.classList.add('closing');
                
                // Удаляем после анимации
                notification.addEventListener('animationend', () => {
                    notification.remove();
                });
            },
            
            success(title, message, duration) {
                return this.show({ title, message, type: 'success', duration });
            },
            
            error(title, message, duration) {
                return this.show({ title, message, type: 'error', duration });
            },
            
            warning(title, message, duration) {
                return this.show({ title, message, type: 'warning', duration });
            },
            
            info(title, message, duration) {
                return this.show({ title, message, type: 'info', duration });
            }
        };

        // Загружаем все вопросы с сервера
        async function fetchAllQuestions() {
            try {
                // Показываем индикатор загрузки
                document.getElementById('questionsLoading').style.display = 'flex';
                document.getElementById('questionsContainer').style.display = 'none';
                isLoading = true;
                
                // Запускаем прогресс бар и показываем модальное окно
                ProgressBar.init();
                ProgressBar.start();
                ProgressBar.showModalProgress('Загрузка вопросов...');
                
                const startTime = Date.now();
                
                const res = await fetch('/api/tests/all', { 
                    credentials: "include"
                });
                
                // Эмулируем реальную загрузку с сервера (нужно для демонстрации прогресс-бара)
                const jsonResponse = await simulateProgressiveLoad(res);
                
                // Определим минимальное время загрузки для демонстрации
                const elapsedTime = Date.now() - startTime;
                const minLoadingTime = 1500; // 1.5 секунды
                
                if (elapsedTime < minLoadingTime) {
                    await new Promise(resolve => setTimeout(resolve, minLoadingTime - elapsedTime));
                }
                
                if (jsonResponse.status === "ok" && Array.isArray(jsonResponse.data)) {
                    allQuestions = jsonResponse.data;
                    filteredQuestions = [...allQuestions];
                    
                    // Собираем уникальные категории для фильтра
                    collectCategories();
                    
                    // Собираем статистику
                    calculateStats();
                    
                    // Обновляем статистику
                    updateStats();
                    
                    // Отображаем вопросы
                    renderQuestions();
                    
                    // Показываем успешное сообщение
                    Notification.success(
                        "Загрузка завершена", 
                        `Загружено ${allQuestions.length} вопросов`
                    );
                } else {
                    console.error("Ошибка загрузки вопросов:", jsonResponse.message);
                    document.getElementById('questionsContainer').innerHTML = 
                        '<div class="no-results">Ошибка при загрузке вопросов. Пожалуйста, попробуйте позже.</div>';
                    document.getElementById('questionsContainer').style.display = 'block';
                    
                    // Показываем сообщение об ошибке
                    Notification.error(
                        "Ошибка загрузки", 
                        jsonResponse.message || "Не удалось загрузить вопросы"
                    );
                }
            } catch (error) {
                console.error("Ошибка запроса:", error);
                document.getElementById('questionsContainer').innerHTML = 
                    '<div class="no-results">Ошибка при загрузке вопросов. Пожалуйста, попробуйте позже.</div>';
                document.getElementById('questionsContainer').style.display = 'block';
                
                // Показываем сообщение об ошибке
                Notification.error(
                    "Ошибка запроса", 
                    error.message || "Не удалось выполнить запрос к серверу"
                );
            } finally {
                // Скрываем индикатор загрузки
                document.getElementById('questionsLoading').style.display = 'none';
                
                // Завершаем прогресс бар
                ProgressBar.complete();
                
                isLoading = false;
            }
        }

        // Эмуляция прогрессивной загрузки с сервера для демонстрации прогресс-бара
        async function simulateProgressiveLoad(response) {
            const reader = response.body.getReader();
            const contentLength = +response.headers.get('Content-Length') || 0;
            
            let receivedLength = 0;
            let chunks = [];
            
            while(true) {
                const {done, value} = await reader.read();
                
                if (done) {
                    break;
                }
                
                chunks.push(value);
                receivedLength += value.length;
                
                // Рассчитываем процент загрузки
                if (contentLength) {
                    const progress = Math.round((receivedLength / contentLength) * 100);
                    ProgressBar.update(progress);
                } else {
                    // Если размер не известен, эмулируем прогресс
                    ProgressBar.update(Math.min(95, Math.random() * 30 + 65));
                }
                
                // Добавляем небольшую задержку для более наглядной демонстрации
                await new Promise(resolve => setTimeout(resolve, 100 + Math.random() * 300));
            }
            
            // Объединяем все фрагменты ответа
            const chunksAll = new Uint8Array(receivedLength);
            let position = 0;
            for (let chunk of chunks) {
                chunksAll.set(chunk, position);
                position += chunk.length;
            }
            
            // Преобразуем в текст и затем в JSON
            const text = new TextDecoder('utf-8').decode(chunksAll);
            return JSON.parse(text);
        }

        // Собираем уникальные категории для фильтра
        function collectCategories() {
            categories.clear();
            
            allQuestions.forEach(q => {
                if (q.categories && Array.isArray(q.categories)) {
                    q.categories.forEach(category => {
                        categories.add(category);
                    });
                }
            });
            
            // Обновляем список тегов категорий
            const tagsContainer = document.getElementById('categoryTags');
            tagsContainer.innerHTML = '<div class="category-tag active" data-category="">Все категории</div>';
            
            // Сортируем категории в соответствии с установленным порядком
            const sortedCategories = Array.from(categories).sort((a, b) => {
                const indexA = PDD_CATEGORIES.indexOf(a);
                const indexB = PDD_CATEGORIES.indexOf(b);
                
                // Если обе категории в списке, сортируем по индексу
                if (indexA !== -1 && indexB !== -1) {
                    return indexA - indexB;
                }
                
                // Если только одна из категорий в списке
                if (indexA !== -1) return -1;
                if (indexB !== -1) return 1;
                
                // Если ни одна из категорий не в списке, сортируем по алфавиту
                return a.localeCompare(b);
            });
            
            sortedCategories.forEach(category => {
                const tag = document.createElement('div');
                tag.className = 'category-tag';
                tag.setAttribute('data-category', category);
                tag.textContent = category;
                tag.addEventListener('click', () => selectCategoryTag(category));
                tagsContainer.appendChild(tag);
            });
        }

        // Расчет статистики по категориям и разделам
        function calculateStats() {
            categoryStats = {};
            sectionStats = {};
            
            // Инициализация счетчиков для всех известных категорий и разделов
            PDD_CATEGORIES.forEach(cat => {
                categoryStats[cat] = 0;
            });
            
            PDD_SECTIONS.forEach(section => {
                sectionStats[section.uid] = 0;
            });
            
            // Подсчет вопросов по категориям и разделам
            allQuestions.forEach(q => {
                // Подсчет по категориям
                if (q.categories && Array.isArray(q.categories)) {
                    q.categories.forEach(cat => {
                        if (categoryStats[cat] !== undefined) {
                            categoryStats[cat]++;
                        } else {
                            categoryStats[cat] = 1;
                        }
                    });
                }
                
                // Подсчет по разделам ПДД
                if (q.pdd_section_uids && Array.isArray(q.pdd_section_uids)) {
                    q.pdd_section_uids.forEach(section => {
                        if (sectionStats[section] !== undefined) {
                            sectionStats[section]++;
                        } else {
                            sectionStats[section] = 1;
                        }
                    });
                }
            });
        }

        // Обновляем статистику на странице
        function updateStats() {
            // Обновляем основную статистику
            document.getElementById('totalQuestions').textContent = allQuestions.length;
            
            const withMediaCount = allQuestions.filter(q => q.has_media).length;
            document.getElementById('withMediaCount').textContent = withMediaCount;
            
            document.getElementById('categoriesCount').textContent = categories.size;
            
            // Подсчет уникальных разделов, используемых в вопросах
            const usedSections = new Set();
            allQuestions.forEach(q => {
                if (q.pdd_section_uids && Array.isArray(q.pdd_section_uids)) {
                    q.pdd_section_uids.forEach(section => usedSections.add(section));
                }
            });
            document.getElementById('sectionsCount').textContent = usedSections.size;
            
            // Обновляем детальную статистику по категориям
            const categoriesGrid = document.getElementById('categoriesStatsGrid');
            categoriesGrid.innerHTML = '';
            
            // Сортируем категории по количеству вопросов (по убыванию)
            const sortedCategories = Object.entries(categoryStats)
                .filter(([_, count]) => count > 0)
                .sort((a, b) => b[1] - a[1]);
            
            sortedCategories.forEach(([category, count]) => {
                const item = document.createElement('div');
                item.className = 'stats-item';
                item.innerHTML = `
                    <div class="stats-item-title">${category}</div>
                    <div class="stats-item-count">
                        <i class='bx bx-test-tube'></i> ${count}
                    </div>
                `;
                categoriesGrid.appendChild(item);
            });
            
            // Обновляем детальную статистику по разделам ПДД
            const sectionsGrid = document.getElementById('sectionsStatsGrid');
            sectionsGrid.innerHTML = '';
            
            // Сортируем разделы по порядку в PDD_SECTIONS
            const sectionEntries = Object.entries(sectionStats)
                .filter(([_, count]) => count > 0);
            
            const sortedSections = sectionEntries.sort((a, b) => {
                const sectionA = PDD_SECTIONS.find(s => s.uid === a[0]);
                const sectionB = PDD_SECTIONS.find(s => s.uid === b[0]);
                
                if (sectionA && sectionB) {
                    return sectionA.order - sectionB.order;
                }
                
                return 0;
            });
            
            sortedSections.forEach(([sectionUid, count]) => {
                const section = PDD_SECTIONS.find(s => s.uid === sectionUid);
                const title = section ? section.title : sectionUid;
                
                const item = document.createElement('div');
                item.className = 'stats-item';
                item.innerHTML = `
                    <div class="stats-item-title" title="${title}">${title}</div>
                    <div class="stats-item-count">
                        <i class='bx bx-book-open'></i> ${count}
                    </div>
                `;
                sectionsGrid.appendChild(item);
            });
        }

        // Применяем фильтры и поиск
        function applyFilters() {
            const searchText = document.getElementById('searchInput').value.toLowerCase();
            const selectedCategory = selectedCategoryTag;
            const selectedSection = document.getElementById('sectionFilter').value;
            
            // Получаем активный фильтр медиа
            const activeMediaBtn = document.querySelector('.media-option.active');
            const mediaFilter = activeMediaBtn ? activeMediaBtn.getAttribute('data-value') : '';
            
            // Фильтруем вопросы
            filteredQuestions = allQuestions.filter(q => {
                // Текстовый поиск
                const matchesSearch = searchText === '' || 
                    q.question_text.toLowerCase().includes(searchText);
                
                // Фильтр по категории
                const matchesCategory = selectedCategory === '' || 
                    (q.categories && q.categories.includes(selectedCategory));
                
                // Фильтр по разделу ПДД
                const matchesSection = selectedSection === '' || 
                    (q.pdd_section_uids && q.pdd_section_uids.includes(selectedSection));
                
                // Фильтр по наличию медиа
                const matchesMedia = mediaFilter === '' || 
                    (mediaFilter === 'true' && q.has_media) || 
                    (mediaFilter === 'false' && !q.has_media);
                
                return matchesSearch && matchesCategory && matchesSection && matchesMedia;
            });
            
            // Обновляем UI и отображаем результаты
            renderQuestions();
        }

        // Сбрасываем все фильтры
        function resetFilters() {
            // Сбрасываем поиск
            document.getElementById('searchInput').value = '';
            
            // Сбрасываем категорию
            selectedCategoryTag = '';
            document.querySelectorAll('.category-tag').forEach((tag, index) => {
                tag.classList.toggle('active', index === 0);
            });
            
            // Сбрасываем выпадающий список разделов
            document.getElementById('sectionFilter').value = '';
            
            // Сбрасываем фильтр по медиа
            document.querySelectorAll('.media-option').forEach((btn, index) => {
                btn.classList.toggle('active', index === 0);
            });
            
            // Сбрасываем фильтрацию
            filteredQuestions = [...allQuestions];
            currentPage = 1;
            
            // Обновляем UI
            renderQuestions();
            
            // Уведомление
            Notification.info("Фильтры сброшены", "Показаны все вопросы", 3000);
        }

        // Отображаем список вопросов с пагинацией
        function renderQuestions() {
            if (isLoading) return;
            
            const container = document.getElementById('questionsContainer');
            const paginationElement = document.getElementById('pagination');
            
            // Показываем контейнер вопросов
            container.style.display = 'block';
            
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, filteredQuestions.length);
            const currentQuestions = filteredQuestions.slice(startIndex, endIndex);
            
            // Если нет результатов
            if (currentQuestions.length === 0) {
                container.innerHTML = '<div class="no-results">Вопросы не найдены</div>';
                // Скрываем пагинацию
                paginationElement.style.display = 'none';
                return;
            }
            
            // Показываем пагинацию
            paginationElement.style.display = 'flex';
            
            // Создаем список карточек вопросов
            container.innerHTML = '';
            currentQuestions.forEach(q => {
                const div = document.createElement("div");
                div.className = "question-card";
                
                // Сокращаем текст вопроса, если он слишком длинный
                let questionText = q.question_text;
                if (questionText.length > 120) {
                    questionText = questionText.substring(0, 117) + '...';
                }
                
                // Подготавливаем данные для отображения категорий в более читаемом виде
                const categoryText = q.categories && q.categories.length 
                    ? q.categories.join(' ') 
                    : 'Нет категорий';
                
                div.innerHTML = `
                    <div class="question-header">
                        <h3>${questionText}</h3>
                        <div class="question-actions">
                            <button class="action-btn toggle-btn" onclick="toggleDetails('${q.uid}', this)" title="Подробнее">
                                <i class='bx bx-chevron-down'></i>
                            </button>
                            <button class="action-btn edit-btn" onclick="redirectToEdit('${q.uid}')" title="Редактировать">
                                <i class='bx bx-edit'></i>
                            </button>
                            <button class="action-btn delete-btn" onclick="deleteQuestion('${q.uid}')" title="Удалить">
                                <i class='bx bx-trash'></i>
                            </button>
                        </div>
                    </div>
                    <div class="meta">
                        <div class="meta-item">
                            <i class='bx bx-category'></i>
                            ${categoryText}
                        </div>
                        <div class="meta-item">
                            <i class='bx ${q.has_media ? 'bx-image' : 'bx-image-alt'}'></i>
                            ${q.has_media ? 'Есть медиа' : 'Без медиа'}
                        </div>
                        ${q.pdd_section_uids && q.pdd_section_uids.length ? `
                        <div class="meta-item">
                            <i class='bx bx-book'></i>
                            ${renderSectionInfo(q.pdd_section_uids)}
                        </div>
                        ` : ''}
                        <div class="uid">UID: ${q.uid}</div>
                    </div>
                    <div class="details" id="details-${q.uid}"></div>
                `;
                container.appendChild(div);
            });
            
            // Обновляем пагинацию
            renderPagination();
        }

        // Создаем тэги категорий
        function renderCategoryTags(categories) {
            if (!categories || !Array.isArray(categories) || categories.length === 0) {
                return '<span class="category-tag">Без категории</span>';
            }
            
            return categories.map(category => 
                `<span class="category-tag" onclick="event.stopPropagation(); selectCategoryTag('${category}')">${category}</span>`
            ).join('');
        }

        // Отображаем информацию о разделах ПДД
        function renderSectionInfo(sectionUids) {
            if (!sectionUids || !Array.isArray(sectionUids) || sectionUids.length === 0) {
                return 'Без раздела';
            }
            
            // Показываем только количество разделов
            return `${sectionUids.length} ${declOfNum(sectionUids.length, ['раздел', 'раздела', 'разделов'])}`;
        }

        // Склонение числительных
        function declOfNum(number, titles) {
            const cases = [2, 0, 1, 1, 1, 2];
            return titles[
                (number % 100 > 4 && number % 100 < 20) ? 
                2 : 
                cases[(number % 10 < 5) ? number % 10 : 5]
            ];
        }

        // Отображаем пагинацию
        function renderPagination() {
            const totalPages = Math.ceil(filteredQuestions.length / itemsPerPage);
            const paginationElement = document.getElementById('pagination');
            paginationElement.innerHTML = '';
            
            // Если страниц меньше 2, не показываем пагинацию
            if (totalPages <= 1) {
                paginationElement.style.display = 'none';
                return;
            }
            
            // Кнопка "Предыдущая"
            if (currentPage > 1) {
                const prevButton = document.createElement('div');
                prevButton.className = 'pagination-item';
                prevButton.innerHTML = '<i class="bx bx-chevron-left"></i>';
                prevButton.addEventListener('click', () => {
                    currentPage--;
                    renderQuestions();
                });
                paginationElement.appendChild(prevButton);
            }
            
            // Номера страниц
            const maxPages = 5; // Максимальное количество видимых номеров страниц
            let startPage = Math.max(1, currentPage - Math.floor(maxPages / 2));
            let endPage = Math.min(totalPages, startPage + maxPages - 1);
            
            // Корректируем startPage, если endPage достиг максимума
            if (endPage === totalPages) {
                startPage = Math.max(1, endPage - maxPages + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const pageButton = document.createElement('div');
                pageButton.className = 'pagination-item' + (i === currentPage ? ' active' : '');
                pageButton.textContent = i;
                pageButton.addEventListener('click', () => {
                    currentPage = i;
                    renderQuestions();
                });
                paginationElement.appendChild(pageButton);
            }
            
            // Кнопка "Следующая"
            if (currentPage < totalPages) {
                const nextButton = document.createElement('div');
                nextButton.className = 'pagination-item';
                nextButton.innerHTML = '<i class="bx bx-chevron-right"></i>';
                nextButton.addEventListener('click', () => {
                    currentPage++;
                    renderQuestions();
                });
                paginationElement.appendChild(nextButton);
            }
        }

        // Функция переключения подробной информации с отображением прогресс-бара
        async function toggleDetails(uid, btn) {
            const detailsDiv = document.getElementById(`details-${uid}`);
            
            // Если детали уже раскрыты – скрываем их
            if (detailsDiv.style.display === "block") {
                detailsDiv.style.display = "none";
                btn.innerHTML = '<i class="bx bx-chevron-down"></i>';
                btn.classList.remove('active');
                return;
            }
            
            // Очистка и создание прогресс-бара
            detailsDiv.innerHTML = '<div class="progress-bar"><div class="progress-bar-inner"></div></div>';
            detailsDiv.style.display = "block";
            btn.classList.add('active');
            
            try {
                // Показываем модальное окно с прогрессом
                ProgressBar.showModalProgress('Загрузка данных вопроса...');
                
                // Запускаем реальный прогресс-бар
                ProgressBar.start();
                
                const res = await fetch(`/api/tests/by_uid/${uid}`, { credentials: "include" });
                if (!res.ok) throw new Error("Ошибка запроса деталей");
                
                // Используем функцию с имитацией прогрессивной загрузки
                const parsedResponse = await simulateProgressiveLoad(res);
                
                // Извлекаем объект с данными (если он вложен в data)
                const data = parsedResponse.data ? parsedResponse.data : parsedResponse;
                displayQuestionDetails(data, detailsDiv);
                btn.innerHTML = '<i class="bx bx-chevron-up"></i>';
            } catch (error) {
                console.error("Ошибка при загрузке деталей:", error);
                detailsDiv.innerHTML = `<p>Ошибка загрузки деталей.</p>`;
                
                // Показываем уведомление об ошибке
                Notification.error("Ошибка", "Не удалось загрузить детали вопроса");
            } finally {
                // Завершаем прогресс-бар
                ProgressBar.complete();
            }
        }
        
        // Отображение всей информации из объекта data
        function displayQuestionDetails(data, container) {
            let html = `<div class="question-details">`;
            
            // Основная информация
            html += `<div class="details-section">
                <h4><i class='bx bx-info-circle'></i> Основная информация</h4>
                <div class="details-row">
                    <div class="details-label">Вопрос:</div>
                    <div class="details-value">${data.question_text}</div>
                </div>
                <div class="details-row">
                    <div class="details-label">Пояснение:</div>
                    <div class="details-value">${data.explanation || "Не указано"}</div>
                </div>
            </div>`;
            
            // Варианты ответа
            if (data.options && Array.isArray(data.options)) {
                html += `<div class="details-section">
                    <h4><i class='bx bx-list-check'></i> Варианты ответа</h4>
                    <div class="options-list">`;
                
                data.options.forEach(opt => {
                    const isCorrect = opt.label === data.correct_label;
                    html += `<div class="option ${isCorrect ? 'correct' : ''}">
                        <strong>${opt.label}:</strong> ${opt.text}
                        ${isCorrect ? ' <i class="bx bx-check" style="color: #4CAF50;"></i>' : ''}
                    </div>`;
                });
                
                html += `</div></div>`;
            }
            
            // Категории и теги
            html += `<div class="details-section">
                <h4><i class='bx bx-category'></i> Категории и разделы</h4>
                <div class="details-row">
                    <div class="details-label">Категории:</div>
                    <div class="details-value">${
                        data.categories && data.categories.length ? 
                        data.categories.map(c => `<span class="category-tag">${c}</span>`).join(' ') : 
                        "Не указаны"
                    }</div>
                </div>`;
            
            if (data.pdd_section_uids && Array.isArray(data.pdd_section_uids)) {
                html += `<div class="details-row">
                    <div class="details-label">Разделы ПДД:</div>
                    <div class="details-value">${data.pdd_section_uids.map(uid => {
                        const section = PDD_SECTIONS.find(s => s.uid === uid);
                        return section ? section.title : uid;
                    }).join(", ")}</div>
                </div>`;
            }
            
            html += `</div>`;
            
            // Медиа контент
            if (data.media_file_base64 && data.media_filename) {
                html += `<div class="details-section">
                    <h4><i class='bx bx-image'></i> Медиа контент</h4>
                    <div style="text-align: center; margin-bottom: 1rem;">`;
                
                if (data.media_filename.endsWith(".mp4")) {
                    html += `<video controls style="max-width: 100%; max-height: 400px; border-radius: 6px;" src="data:video/mp4;base64,${data.media_file_base64}"></video>`;
                } else {
                    html += `<img style="max-width: 100%; max-height: 400px; border-radius: 6px;" src="data:image/*;base64,${data.media_file_base64}" alt="Медиа контент">`;
                }
                
                html += `</div>
                <div class="details-row">
                    <div class="details-label">Имя файла:</div>
                    <div class="details-value">${data.media_filename}</div>
                </div>
                <div class="details-row">
                    <div class="details-label">ID медиа:</div>
                    <div class="details-value">${data.media_file_id || "Не указано"}</div>
                </div>
                </div>`;
            }
            
            // Служебная информация
            html += `<div class="details-section">
                <h4><i class='bx bx-code-alt'></i> Служебная информация</h4>
                <div class="details-row">
                    <div class="details-label">Создан:</div>
                    <div class="details-value">${data.created_by_name} (IIN: ${data.created_by_iin})</div>
                </div>
                <div class="details-row">
                    <div class="details-label">UID:</div>
                    <div class="details-value">${data.uid}</div>
                </div>
                <div class="details-row">
                    <div class="details-label">ID:</div>
                    <div class="details-value">${data.id}</div>
                </div>
                <div class="details-row">
                    <div class="details-label">Дата создания:</div>
                    <div class="details-value">${formatDate(data.created_at)}</div>
                </div>
                <div class="details-row">
                    <div class="details-label">Дата обновления:</div>
                    <div class="details-value">${data.updated_at ? formatDate(data.updated_at) : "Не обновлялся"}</div>
                </div>
                <div class="details-row">
                    <div class="details-label">Удалён:</div>
                    <div class="details-value">${data.deleted ? "Да" : "Нет"}</div>
                </div>
                ${data.deleted ? `
                <div class="details-row">
                    <div class="details-label">Удалён кем:</div>
                    <div class="details-value">${data.deleted_by || "-"}</div>
                </div>
                <div class="details-row">
                    <div class="details-label">Дата удаления:</div>
                    <div class="details-value">${data.deleted_at ? formatDate(data.deleted_at) : "-"}</div>
                </div>` : ''}
            </div>`;
            
            html += `</div>`;
            
            // Добавляем стили для деталей непосредственно в контейнер
            container.innerHTML = html;
        }
        
        // Форматирование даты
        function formatDate(dateString) {
            if (!dateString) return "Неизвестно";
            
            try {
                const date = new Date(dateString);
                return date.toLocaleString('ru-RU', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch (e) {
                return dateString;
            }
        }
        
        // Функция для редиректа на страницу редактирования
        function redirectToEdit(uid) {
            window.location.href = `/edit_question.html?uid=${uid}`;
        }
        
        // Функция для удаления вопроса
        async function deleteQuestion(uid) {
            if (!confirm('Вы уверены, что хотите удалить этот вопрос?')) {
                return;
            }
            
            try {
                // Показываем модальное окно с прогрессом
                ProgressBar.showModalProgress('Удаление вопроса...');
                ProgressBar.start();
                
                const res = await fetch(`/api/tests/delete/${uid}`, { 
                    method: 'DELETE',
                    credentials: "include"
                });
                
                const data = await res.json();
                
                if (data.status === "ok") {
                    // Удаляем вопрос из массивов
                    allQuestions = allQuestions.filter(q => q.uid !== uid);
                    filteredQuestions = filteredQuestions.filter(q => q.uid !== uid);
                    
                    // Обновляем UI
                    renderQuestions();
                    
                    // Пересчитываем статистику
                    calculateStats();
                    updateStats();
                    
                    // Показываем сообщение
                    Notification.success("Успешно", "Вопрос успешно удален");
                } else {
                    Notification.error("Ошибка", data.message || "Ошибка при удалении вопроса");
                }
            } catch (error) {
                console.error("Ошибка при удалении:", error);
                Notification.error("Ошибка", "Ошибка при удалении вопроса");
            } finally {
                ProgressBar.complete();
            }
        }
    </script>
</body>
</html> 
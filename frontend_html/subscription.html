<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>üì¶ –ü–æ–¥–ø–∏—Å–∫–∞</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f7fa;
      color: #333;
      max-width: 600px;
      margin: 2rem auto;
      padding: 20px;
    }
    h2 {
      text-align: center;
      margin-bottom: 1.5rem;
    }
    .card {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0,0,0,0.05);
      margin-bottom: 20px;
    }
    .label {
      font-weight: bold;
      margin-right: 5px;
    }
    .value {
      color: #0066cc;
    }
    .error {
      background: #ffe5e5;
      color: #c40000;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .success {
      background: #e5fbe5;
      color: #207a20;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <h2>üì¶ –ú–æ—è –ø–æ–¥–ø–∏—Å–∫–∞</h2>
  <div id="message"></div>
  <div id="subCard" class="card" style="display: none;"></div>

  <script>
    const API = "https://royal-test.duckdns.org/api";
    const messageDiv = document.getElementById("message");
    const subCard = document.getElementById("subCard");

    function formatDate(iso) {
      const date = new Date(iso);
      return date.toLocaleDateString("ru-RU", {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    async function loadSubscription() {
      try {
        const response = await fetch(`${API}/users/my/subscription`, {
          method: "GET",
          credentials: "include"
        });

        const data = await response.json();

        if (!response.ok) {
          const msg = data.detail || "–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞";
          messageDiv.innerHTML = `<div class="error">‚ùå ${msg}</div>`;
          return;
        }

        if (!data.has_subscription) {
          messageDiv.innerHTML = `<div class="error">‚ùóÔ∏è ${data.message}</div>`;
          return;
        }

        const daysLeft = data.days_left;
        const expiresDate = formatDate(data.expires_at);

        messageDiv.innerHTML = `<div class="success">‚úÖ –£ –≤–∞—Å –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞</div>`;

        subCard.innerHTML = `
          <p><span class="label">üÜî –¢–∏–ø –ø–æ–¥–ø–∏—Å–∫–∏:</span> <span class="value">${data.subscription_type}</span></p>
          <p><span class="label">üìÖ –ò—Å—Ç–µ–∫–∞–µ—Ç:</span> <span class="value">${expiresDate}</span></p>
          <p><span class="label">‚è≥ –û—Å—Ç–∞–ª–æ—Å—å –¥–Ω–µ–π:</span> <span class="value">${daysLeft}</span></p>
        `;
        subCard.style.display = "block";

      } catch (err) {
        messageDiv.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ${err.message}</div>`;
      }
    }

    loadSubscription();
  </script>
</body>
</html>

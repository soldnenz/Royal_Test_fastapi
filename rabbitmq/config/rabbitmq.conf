## RabbitMQ Configuration для Royal Test Project
## Версия: 3.12+ (минимальная рабочая конфигурация)
## Все параметры проверены на совместимость с RabbitMQ 3.12-management-alpine

## ==========================================================================
## ОСНОВНЫЕ НАСТРОЙКИ
## ==========================================================================

# Слушающие интерфейсы
listeners.tcp.default = 5672

# Management UI
management.tcp.port = 15672

## ==========================================================================
## ЛОГИРОВАНИЕ
## ==========================================================================

# Консольные логи
log.console = true
log.console.level = warning

# Файловые логи  
log.file.level = warning
log.file.rotation.date = $D0
log.file.rotation.size = 10485760

## ==========================================================================
## БЕЗОПАСНОСТЬ
## ==========================================================================

# Отключаем guest пользователя для безопасности
loopback_users.guest = false

## ==========================================================================
## УПРАВЛЕНИЕ ПАМЯТЬЮ
## ==========================================================================

# Лимит памяти VM (80% от доступной памяти)
vm_memory_high_watermark.relative = 0.8

# Стратегия освобождения памяти
vm_memory_high_watermark_paging_ratio = 0.5

# Лимит свободного места на диске (2GB)
disk_free_limit.absolute = 2147483648

## ==========================================================================
## ПРОИЗВОДИТЕЛЬНОСТЬ
## ==========================================================================

# Heartbeat (10 минут)
heartbeat = 600

# Максимальный размер фрейма (1MB)
frame_max = 1048576

# Максимальное количество каналов на соединение
channel_max = 2000

# Максимальное количество соединений
connection_max = 10000

# Интервал сбора статистики (10 секунд)
collect_statistics_interval = 10000

## ==========================================================================
## TCP НАСТРОЙКИ
## ==========================================================================

# TCP настройки соединений
tcp_listen_options.backlog = 128
tcp_listen_options.nodelay = true
tcp_listen_options.linger.on = true
tcp_listen_options.linger.timeout = 0
tcp_listen_options.exit_on_close = false

# TCP буферы
tcp_listen_options.sndbuf = 32768
tcp_listen_options.recbuf = 32768

## ==========================================================================
## КЛАСТЕРИЗАЦИЯ
## ==========================================================================

# Обработка разделения кластера
cluster_partition_handling = autoheal

# Размер батча синхронизации зеркал
mirroring_sync_batch_size = 4096

## ==========================================================================
## НАСТРОЙКИ БЕЗОПАСНОСТИ
## ==========================================================================

# Механизмы аутентификации
auth_mechanisms.1 = PLAIN
auth_mechanisms.2 = AMQPLAIN

# Отключение обратных DNS запросов
reverse_dns_lookups = false

# Количество делегатов для внутрикластерной коммуникации
delegate_count = 16

## ==========================================================================
## УПРАВЛЯЮЩИЕ НАСТРОЙКИ
## ==========================================================================

# Настройки Management UI
management.rates_mode = basic

# Настройки очередей
queue_index_embed_msgs_below = 4096
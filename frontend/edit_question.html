<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
  <meta charset="UTF-8">
  <title>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —à—Ä–∏—Ñ—Ç–∞ -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    /* –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ç–µ–º */
    :root {
      --color-primary: #4fc3f7;
      --color-primary-dark: #0288d1;
      --color-bg-light: #f2f5f9;
      --color-bg-dark: #121212;
      --color-text-light: #1a1a1a;
      --color-text-dark: #f5f5f5;
      --glass-bg-light: rgba(255, 255, 255, 0.6);
      --glass-bg-dark: rgba(33, 33, 33, 0.5);
      --input-bg-light: rgba(240, 240, 240, 0.9);
      --input-bg-dark: rgba(50, 50, 50, 0.8);
      --border-light: rgba(255, 255, 55, 0.5);
      --border-dark: rgba(0, 0, 0, 0.3);
    }
    html[data-theme='light'] {
      --bg: var(--color-bg-light);
      --text: var(--color-text-light);
      --glass: var(--glass-bg-light);
      --input-bg: var(--input-bg-light);
      --border: var(--border-light);
    }
    html[data-theme='dark'] {
      --bg: var(--color-bg-dark);
      --text: var(--color-text-dark);
      --glass: var(--glass-bg-dark);
      --input-bg: var(--input-bg-dark);
      --border: var(--border-dark);
    }
    /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html, body {
      height: 100%;
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--text);
      transition: background 0.3s, color 0.3s;
      overflow-x: hidden;
    }
    ::-webkit-scrollbar {
      width: 10px;
    }
    ::-webkit-scrollbar-track {
      background: transparent;
    }
    ::-webkit-scrollbar-thumb {
      background-color: rgba(100, 100, 100, 0.3);
      border-radius: 10px;
    }
    .wrapper {
      max-width: 860px;
      width: 95%;
      margin: 2rem auto;
      background: var(--glass);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 2rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      border: 1px solid var(--border);
    }
    h1 {
      text-align: center;
      margin-bottom: 2rem;
      font-size: 1.8rem;
      color: var(--color-primary-dark);
    }
    .appbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }
    .appbar button {
      background: none;
      border: none;
      color: var(--text);
      font-size: 1.5rem;
      cursor: pointer;
      transition: color 0.2s;
    }
    .appbar button:hover {
      color: var(--color-primary-dark);
    }
    .menu-dropdown {
      position: relative;
    }
    .menu-dropdown-content {
      display: none;
      position: absolute;
      right: 0;
      top: 110%;
      background: var(--glass);
      backdrop-filter: blur(15px);
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
      z-index: 999;
    }
    .menu-dropdown.active .menu-dropdown-content {
      display: block;
    }
    .menu-dropdown-content button {
      background: none;
      border: none;
      padding: 0.75rem 1rem;
      width: 100%;
      text-align: left;
      color: var(--text);
      font-size: 1rem;
      cursor: pointer;
    }
    .menu-dropdown-content button:hover {
      background: rgba(0,0,0,0.05);
    }
    label {
      font-weight: 600;
      display: block;
      margin: 1.2rem 0 0.5rem;
    }
    input[type="text"],
    textarea,
    select {
      width: 100%;
      padding: 0.6rem;
      border-radius: 12px;
      border: none;
      background: var(--input-bg);
      backdrop-filter: blur(10px);
      color: inherit;
      font-size: 1rem;
      outline: none;
    }
    select[multiple] {
      height: auto;
      cursor: pointer;
    }
    select option {
      padding: 0.5rem;
    }
    select option:checked {
      background-color: var(--color-primary);
      color: #fff;
    }
    button[type="submit"],
    .btn {
      background: var(--color-primary);
      color: #fff;
      border: none;
      padding: 0.7rem 1.4rem;
      font-weight: bold;
      font-size: 1rem;
      border-radius: 12px;
      cursor: pointer;
      margin-top: 1.5rem;
      transition: background 0.2s;
    }
    button[type="submit"]:hover,
    .btn:hover {
      background: var(--color-primary-dark);
    }
    /* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è input file —Å drag & drop */
    .file-input-container {
      position: relative;
      width: 100%;
      text-align: center;
      margin-top: 1rem;
      padding: 1rem;
      border: 2px dashed var(--color-primary);
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.15);
      color: var(--text);
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .file-input-container:hover {
      background: rgba(255, 255, 255, 0.25);
    }
    .file-input {
      display: none;
    }
    #pddSectionList label {
      display: inline-flex;
      align-items: center;
      padding: 8px 12px;
      margin: 5px;
      border-radius: 10px;
      background: var(--input-bg);
      cursor: pointer;
      user-select: none;
      border: 1px solid var(--border);
      transition: background 0.2s, color 0.2s;
    }
    #pddSectionList input[type="checkbox"] {
      margin-right: 6px;
    }
    #pddSectionList input[type="checkbox"]:checked + span {
      font-weight: bold;
      color: var(--color-primary);
    }
    #optionsContainer > div {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-top: 10px;
    }
    #optionsContainer input[type="text"] {
      flex: 1;
    }
    #optionsContainer button {
      padding: 0.5rem 1rem;
      font-size: 1.2rem;
      border-radius: 10px;
    }
    .animation-container {
      margin: 0 auto 1rem;
      display: flex;
      justify-content: center;
      max-width: 640px;
      border-radius: 16px;
      background: transparent;
    }
    /* –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä (–ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º—ã) */
    #progressBarInner {
      width: 0%;
      height: 100%;
      background: var(--color-primary);
      transition: width 0.4s ease;
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <!-- –í–µ—Ä—Ö–Ω–µ–µ –º–µ–Ω—é –∏ –ø–∞–Ω–µ–ª—å –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
    <div class="appbar">
      <button onclick="history.back()" title="–ù–∞–∑–∞–¥">‚Üê</button>
      <div class="menu-dropdown" id="menuDropdown">
        <button title="–ú–µ–Ω—é" onclick="toggleMenu()">‚ãÆ</button>
        <div class="menu-dropdown-content">
          <button onclick="toggleTheme()">üåì –°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É</button>
        </div>
      </div>
    </div>
    <div class="animation-container">
      <video id="loopVideo" muted autoplay playsinline style="width:35%; border-radius: 12px;">
        <source src="help/duck/typing.mp4" type="video/mp4" />
        –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ üò¢
      </video>
    </div>

    <h1>üìù –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞</h1>

    <form id="editQuestionForm">
      <label for="questionText">–¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞:</label>
      <textarea id="questionText" rows="3" required></textarea>

      <label for="explanation">–û–±—ä—è—Å–Ω–µ–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):</label>
      <textarea id="explanation" rows="2" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ..."></textarea>

      <label for="categories">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏:</label>
      <div id="categoryList" style="display:flex; flex-wrap:wrap; gap:8px;"></div>

      <label for="pddSearch">–ü–æ–∏—Å–∫ –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º –ü–î–î:</label>
      <input type="text" id="pddSearch" placeholder="üîç –ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å..." />

      <label for="pddSections">–†–∞–∑–¥–µ–ª—ã –ü–î–î:</label>
      <div id="pddSectionList" style="display:flex; flex-wrap:wrap; gap:6px;"></div>

      <label style="margin-top: 1.5rem;">–í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–∞:</label>
      <div id="optionsContainer"></div>
      <button type="button" id="addOptionBtn" class="btn">‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç</button>

      <label style="margin-top: 1.5rem;">–ú–µ–¥–∏–∞—Ñ–∞–π–ª:</label>
      <div class="file-input-container" id="dropzone">
        üìÇ –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª —Å—é–¥–∞ –∏–ª–∏ <label for="media" class="file-label">–≤—ã–±–µ—Ä–∏—Ç–µ</label>
        <input type="file" id="media" class="file-input" accept="image/jpeg,image/png,video/mp4,video/quicktime">
      </div>
      <!-- –ë–ª–æ–∫ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –º–µ–¥–∏–∞ -->
      <div id="preview" style="margin-top: 1rem;"></div>
      <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –º–µ–¥–∏–∞ (–±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏, –µ—Å–ª–∏ –º–µ–¥–∏–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç) -->
      <div id="mediaControls" style="margin-top: 0.5rem;"></div>

      <div style="margin-top: 1rem; background: rgba(0,0,0,0.1); height: 8px; border-radius: 4px; overflow: hidden;">
        <div id="progressBarInner"></div>
      </div>

      <button type="submit" class="btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
    </form>

    <div id="loading" style="display:none; margin-top: 1rem;">‚è≥ –ó–∞–≥—Ä—É–∂–∞–µ–º...</div>
    <div id="error" style="display:none; margin-top: 1rem; padding: 1rem; background: rgba(255, 0, 0, 0.1); color: red; border-radius: 8px; font-family: monospace;"></div>
    <div id="result" style="display:none; margin-top: 1rem; padding: 1rem; background: rgba(0, 255, 0, 0.1); color: green; border-radius: 8px; font-family: monospace;"></div>
  </div>

  <script>
    // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ñ–ª–∞–≥–∞ —É–¥–∞–ª–µ–Ω–∏—è –º–µ–¥–∏–∞
    let mediaRemoved = false;

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ü–∏–∫–ª–∏—á–µ—Å–∫–æ–≥–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –≤–∏–¥–µ–æ
    const loopVideo = document.getElementById("loopVideo");
    loopVideo.addEventListener('loadeddata', () => {
      setInterval(() => {
        loopVideo.currentTime = 0;
        loopVideo.play();
      }, 15000);
    });

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã
    const savedTheme = localStorage.getItem("theme") || "light";
    document.documentElement.dataset.theme = savedTheme;
    function toggleTheme() {
      const html = document.documentElement;
      const newTheme = html.dataset.theme === 'dark' ? 'light' : 'dark';
      html.dataset.theme = newTheme;
      localStorage.setItem('theme', newTheme);
    }
    // –†–∞–±–æ—Ç–∞ —Å –º–µ–Ω—é
    function toggleMenu() {
      document.getElementById('menuDropdown').classList.toggle('active');
    }

    // –†–µ–Ω–¥–µ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    const categories = ["A1","A","B1","B","BE","C","C1","BC1","D1","D","Tb","C1","CE", "D1", "DE"];
    const categoryList = document.getElementById("categoryList");
    categories.forEach(cat => {
      const label = document.createElement("label");
      label.style = "padding:6px 12px;border-radius:10px;cursor:pointer;background:var(--input-bg);";
      label.innerHTML = `<input type="checkbox" name="categories" value="${cat}" style="margin-right:6px;">${cat}`;
      categoryList.appendChild(label);
    });

    // –†–µ–Ω–¥–µ—Ä —Ä–∞–∑–¥–µ–ª–æ–≤ –ü–î–î
    const pddData = [
      { uid: "polozheniya", title: "–û–±—â–∏–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è", order: 10 },
      { uid: "voditeli", title: "–û–±—â–∏–µ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ –≤–æ–¥–∏—Ç–µ–ª–µ–π", order: 20 },
      { uid: "peshehody", title: "–û–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ –ø–µ—à–µ—Ö–æ–¥–æ–≤", order: 30 },
      { uid: "passazhiry", title: "–û–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤", order: 40 },
      { uid: "svetofor", title: "–°–∏–≥–Ω–∞–ª—ã —Å–≤–µ—Ç–æ—Ñ–æ—Ä–∞ –∏ —Ä–µ–≥—É–ª–∏—Ä–æ–≤—â–∏–∫–∞", order: 50 },
      { uid: "specsignaly", title: "–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤", order: 60 },
      { uid: "avarijka", title: "–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∞–≤–∞—Ä–∏–π–Ω–æ–π —Å–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –∑–Ω–∞–∫–∞ –∞–≤–∞—Ä–∏–π–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏", order: 70 },
      { uid: "manevrirovanie", title: "–ú–∞–Ω–µ–≤—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ", order: 80 },
      { uid: "raspolozhenie", title: "–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –ø—Ä–æ–µ–∑–∂–µ–π —á–∞—Å—Ç–∏ –¥–æ—Ä–æ–≥–∏", order: 90 },
      { uid: "speed", title: "–°–∫–æ—Ä–æ—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏—è", order: 100 },
      { uid: "obgon", title: "–û–±–≥–æ–Ω, –≤—Å—Ç—Ä–µ—á–Ω—ã–π —Ä–∞–∑—ä–µ–∑–¥", order: 110 },
      { uid: "ostanovka", title: "–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —Å—Ç–æ—è–Ω–∫–∞", order: 120 },
      { uid: "perekrestki", title: "–ü—Ä–æ–µ–∑–¥ –ø–µ—Ä–µ–∫—Ä—ë—Å—Ç–∫–æ–≤", order: 130 },
      { uid: "perehody", title: "–ü–µ—à–µ—Ö–æ–¥–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–∞—Ä—à—Ä—É—Ç–Ω—ã—Ö —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤", order: 140 },
      { uid: "zhd", title: "–î–≤–∏–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∂–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–µ –ø—É—Ç–∏", order: 150 },
      { uid: "magistral", title: "–î–≤–∏–∂–µ–Ω–∏–µ –ø–æ –∞–≤—Ç–æ–º–∞–≥–∏—Å—Ç—Ä–∞–ª—è–º", order: 160 },
      { uid: "zhilaya-zona", title: "–î–≤–∏–∂–µ–Ω–∏–µ –≤ –∂–∏–ª—ã—Ö –∑–æ–Ω–∞—Ö", order: 170 },
      { uid: "prioritet", title: "–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –º–∞—Ä—à—Ä—É—Ç–Ω—ã—Ö —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤", order: 180 },
      { uid: "svetovye-pribory", title: "–ü–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤–Ω–µ—à–Ω–∏–º–∏ —Å–≤–µ—Ç–æ–≤—ã–º–∏ –ø—Ä–∏–±–æ—Ä–∞–º–∏ –∏ –∑–≤—É–∫–æ–≤—ã–º–∏ —Å–∏–≥–Ω–∞–ª–∞–º–∏", order: 190 },
      { uid: "buksirovka", title: "–ë—É–∫—Å–∏—Ä–æ–≤–∫–∞ –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∏—Ö —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤", order: 200 },
      { uid: "uchebnaya-ezda", title: "–£—á–µ–±–Ω–∞—è –µ–∑–¥–∞", order: 210 },
      { uid: "perevozka-passazhirov", title: "–ü–µ—Ä–µ–≤–æ–∑–∫–∞ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤", order: 220 },
      { uid: "perevozka-gruzov", title: "–ü–µ—Ä–µ–≤–æ–∑–∫–∞ –≥—Ä—É–∑–æ–≤", order: 230 },
      { uid: "velosipedy-i-zhivotnye", title: "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –¥–≤–∏–∂–µ–Ω–∏—é –≤–µ–ª–æ—Å–∏–ø–µ–¥–æ–≤, –º–æ–ø–µ–¥–æ–≤, –≥—É–∂–µ–≤—ã—Ö –ø–æ–≤–æ–∑–æ–∫, –∞ —Ç–∞–∫–∂–µ –∂–∏–≤–æ—Ç–Ω—ã—Ö", order: 240 },
      { uid: "invalidy", title: "–û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è –ª—é–¥–µ–π —Å –Ω–∞—Ä—É—à–µ–Ω–∏—è–º–∏ –æ–ø–æ—Ä–Ω–æ-–¥–≤–∏–≥–∞—Ç–µ–ª—å–Ω–æ–≥–æ –∞–ø–ø–∞—Ä–∞—Ç–∞", order: 250 },
      { uid: "znaki", title: "–î–æ—Ä–æ–∂–Ω—ã–µ –∑–Ω–∞–∫–∏", order: 260 },
      { uid: "razmetka", title: "–î–æ—Ä–æ–∂–Ω–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞ –∏ –µ—ë —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏", order: 270 },
      { uid: "dopusk", title: "–û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è –ø–æ –¥–æ–ø—É—Å–∫—É —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤ –∫ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏", order: 280 },
      { uid: "obdzh", title: "–û–ë–î–ñ (–û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–æ—Ä–æ–∂–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è)", order: 290 },
      { uid: "administrativka", title: "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–∫–∞", order: 300 },
      { uid: "medicina", title: "–ú–µ–¥–∏—Ü–∏–Ω–∞", order: 310 },
      { uid: "dtp", title: "–î–¢–ü", order: 320 }
    ];
    const sectionList = document.getElementById("pddSectionList");
    const pddSearch = document.getElementById("pddSearch");
    function renderSections(filter = '') {
      sectionList.innerHTML = '';
      pddData.filter(item => item.title.toLowerCase().includes(filter.toLowerCase()))
        .forEach(item => {
          const label = document.createElement("label");
          label.innerHTML = `<input type="checkbox" name="pddSections" value="${item.uid}" style="margin-right:6px;"><span>${item.title}</span>`;
          sectionList.appendChild(label);
        });
    }
    pddSearch.addEventListener("input", e => {
      renderSections(e.target.value);
    });
    renderSections();

    // –†–∞–±–æ—Ç–∞ —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –æ—Ç–≤–µ—Ç–∞
    let optionCount = 0;
    const maxOptions = 8;
    function addOption() {
      if (optionCount >= maxOptions) {
        alert("–ú–∞–∫—Å–∏–º—É–º 8 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤");
        return;
      }
      const container = document.getElementById("optionsContainer");
      const div = document.createElement("div");
      div.innerHTML = `
        <input type="radio" name="correctOption" value="${optionCount}" ${optionCount === 0 ? 'checked' : ''}>
        <input type="text" required placeholder="–í–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞">
        <button type="button" class="btn" style="background:#e53935;" onclick="this.parentNode.remove(); optionCount--;">‚úñ</button>
      `;
      container.appendChild(div);
      optionCount++;
    }
    document.getElementById("addOptionBtn").addEventListener("click", addOption);

    // –†–∞–±–æ—Ç–∞ —Å –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–º: –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
    const mediaInput = document.getElementById("media");
    const dropzone = document.getElementById("dropzone");
    const preview = document.getElementById("preview");
    const mediaControls = document.getElementById("mediaControls");
    const allowedTypes = ["image/jpeg", "image/png", "video/mp4", "video/quicktime"];
    dropzone.addEventListener("dragover", e => {
      e.preventDefault();
      dropzone.style.background = "rgba(100, 200, 255, 0.3)";
    });
    dropzone.addEventListener("dragleave", () => {
      dropzone.style.background = "rgba(255, 255, 255, 0.15)";
    });
    dropzone.addEventListener("drop", e => {
      e.preventDefault();
      dropzone.style.background = "rgba(255, 255, 255, 0.15)";
      mediaInput.files = e.dataTransfer.files;
      mediaRemoved = false;
      previewMedia();
    });
    mediaInput.addEventListener("change", () => {
      mediaRemoved = false;
      previewMedia();
    });
    function previewMedia() {
      preview.innerHTML = "";
      mediaControls.innerHTML = "";
      const file = mediaInput.files[0];
      if (!file || !allowedTypes.includes(file.type)) return;
      const url = URL.createObjectURL(file);
      if (file.type.startsWith("image")) {
        preview.innerHTML = `<img src="${url}" style="max-width:100%;max-height:300px;border-radius:8px;" />`;
      } else {
        preview.innerHTML = `<video src="${url}" controls style="max-width:100%;max-height:300px;border-radius:8px;"></video>`;
      }
    }

    // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    async function loadQuestionData() {
      const uid = new URLSearchParams(window.location.search).get('uid');
      if (!uid) return showError("‚ùå –ù–µ —É–∫–∞–∑–∞–Ω UID –≤–æ–ø—Ä–æ—Å–∞");
      try {
        const res = await fetch(`/api/tests/by_uid/${uid}`, { credentials: "include" });
        if (!res.ok) return showError("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–∞");
        const jsonResponse = await res.json();
        const data = jsonResponse.data;
        if (!data) return showError("‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–∞");
        document.getElementById("questionText").value = data.question_text || "";
        document.getElementById("explanation").value = data.explanation || "";
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        data.categories && data.categories.forEach(cat => {
          const checkbox = document.querySelector(`input[name='categories'][value='${cat}']`);
          if (checkbox) checkbox.checked = true;
        });
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ –ü–î–î
        data.pdd_section_uids && data.pdd_section_uids.forEach(uid => {
          const checkbox = document.querySelector(`input[name='pddSections'][value='${uid}']`);
          if (checkbox) checkbox.checked = true;
        });
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞
        const optionsContainer = document.getElementById("optionsContainer");
        optionsContainer.innerHTML = "";
        optionCount = 0;
        data.options && data.options.forEach((opt, index) => {
          addOption();
          const lastOptionDiv = optionsContainer.lastElementChild;
          if (lastOptionDiv) {
            lastOptionDiv.querySelector("input[type='text']").value = opt.text;
            if (opt.label === data.correct_label) {
              lastOptionDiv.querySelector("input[type='radio']").checked = true;
            }
          }
        });
        // –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –º–µ–¥–∏–∞ (–µ—Å–ª–∏ –∏–º–µ—é—Ç—Å—è)
        if (data.media_file_base64 && data.media_filename) {
          const mime = data.media_filename.endsWith(".mp4") ? "video/mp4" : "image/*";
          const urlData = `data:${mime};base64,${data.media_file_base64}`;
          if (data.media_filename.endsWith(".mp4")) {
            preview.innerHTML = `<video src="${urlData}" controls style="max-width:100%;max-height:300px;border-radius:8px;"></video>`;
          } else {
            preview.innerHTML = `<img src="${urlData}" style="max-width:100%;max-height:300px;border-radius:8px;" />`;
          }
          // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É "–£–¥–∞–ª–∏—Ç—å –º–µ–¥–∏–∞"
          mediaControls.innerHTML = `<button type="button" class="btn" style="background:#e53935;" onclick="removeMediaFile()">–£–¥–∞–ª–∏—Ç—å –º–µ–¥–∏–∞</button>`;
        }
      } catch (e) {
        console.error(e);
        showError("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–∞");
      }
    }
    function showError(msg) {
      const errorEl = document.getElementById("error");
      errorEl.textContent = msg;
      errorEl.style.display = "block";
    }
    loadQuestionData();

    // –§—É–Ω–∫—Ü–∏—è, –≤—ã–∑—ã–≤–∞–µ–º–∞—è –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "–£–¥–∞–ª–∏—Ç—å –º–µ–¥–∏–∞"
    function removeMediaFile() {
      mediaRemoved = true;
      preview.innerHTML = "";
      mediaControls.innerHTML = "";
      // –°–±—Ä–æ—Å–∏–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ñ–∞–π–ª, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
      mediaInput.value = "";
    }

    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –≤–æ–ø—Ä–æ—Å–∞ (—Å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–º)
    document.getElementById("editQuestionForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const text = document.getElementById("questionText").value.trim();
      const explanation = document.getElementById("explanation").value.trim() || "–¥–∞–Ω–Ω—ã–π –≤–æ–ø—Ä–æ—Å –±–µ–∑ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è";
      const categories = [...document.querySelectorAll("input[name='categories']:checked")].map(o => o.value);
      const sections = [...document.querySelectorAll("input[name='pddSections']:checked")].map(o => o.value);
      const options = [...document.getElementById("optionsContainer").children].map(opt => {
        return { text: opt.querySelector("input[type='text']").value.trim() };
      });
      const correctIndex = [...document.getElementsByName("correctOption")].findIndex(r => r.checked);
      const file = mediaInput.files[0];
      const errorEl = document.getElementById("error");
      const resultEl = document.getElementById("result");
      const loadingEl = document.getElementById("loading");
      const progressBar = document.getElementById("progressBarInner");
      errorEl.style.display = resultEl.style.display = "none";
      errorEl.textContent = resultEl.textContent = "";
      progressBar.style.width = "0%";
      loadingEl.style.display = "block";
      if (!text) return showError("‚ùå –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞");
      if (!categories.length) return showError("‚ùå –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é");
      if (!sections.length) return showError("‚ùå –í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª");
      if (options.length < 2) return showError("‚ùå –ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 2 –≤–∞—Ä–∏–∞–Ω—Ç–∞");
      if (options.some(o => !o.text)) return showError("‚ùå –ü—É—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞");
      const data = {
        question_id: new URLSearchParams(window.location.search).get('uid'),
        new_question_text: text,
        new_explanation: explanation,
        new_options: options,
        new_correct_index: correctIndex,
        new_categories: categories,
        new_pdd_section_uids: sections,
        replace_media: !!file,
        remove_media: mediaRemoved
      };

      console.log('Payload data:', data);

      const formData = new FormData();
      formData.append("payload", JSON.stringify(data));
      if (file) formData.append("new_file", file);

      const xhr = new XMLHttpRequest();
      xhr.open("PUT", "/api/tests/");
      xhr.withCredentials = true;
      xhr.upload.onprogress = e => {
        if (e.lengthComputable) {
          const percent = (e.loaded / e.total) * 100;
          progressBar.style.width = `${percent.toFixed(0)}%`;
        }
      };
      xhr.onload = () => {
        loadingEl.style.display = "none";
        if (xhr.status >= 200 && xhr.status < 300) {
          resultEl.textContent = xhr.responseText;
          resultEl.style.display = "block";
          alert("‚úÖ –í–æ–ø—Ä–æ—Å –æ–±–Ω–æ–≤–ª—ë–Ω!");
        } else {
          try {
            const errorResponse = JSON.parse(xhr.responseText);
            showError(`‚ùå –û—à–∏–±–∫–∞: ${errorResponse.detail || xhr.responseText}`);
          } catch (e) {
            showError(`‚ùå –û—à–∏–±–∫–∞: ${xhr.responseText}`);
          }
        }
      };
      xhr.onerror = () => {
        loadingEl.style.display = "none";
        showError("‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è");
      };
      xhr.send(formData);
    });
  </script>
</body>
</html>
